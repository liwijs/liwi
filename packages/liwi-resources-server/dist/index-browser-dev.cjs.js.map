{"version":3,"file":"index-browser-dev.cjs.js","sources":["../src/ResourceServerCursor.ts","../src/ResourcesServerService.ts"],"sourcesContent":["import { AbstractStoreCursor } from 'liwi-store';\nimport { BaseModel } from 'liwi-types';\nimport Resource from './Resource';\n\nexport default class ResourceServerCursor<\n  Model extends BaseModel,\n  Transformed = any,\n  ConnectedUser = any\n> {\n  private resource: Resource<Model, any, any, Transformed, ConnectedUser>;\n\n  private connectedUser: any;\n\n  private cursor: AbstractStoreCursor<Model, any, any>;\n\n  constructor(\n    resource: Resource<Model, any, any, Transformed, ConnectedUser>,\n    cursor: AbstractStoreCursor<Model, any, any>,\n    connectedUser?: ConnectedUser,\n  ) {\n    this.resource = resource;\n    this.connectedUser = connectedUser;\n    this.cursor = cursor;\n  }\n\n  toArray(): Promise<Transformed[]> {\n    return this.cursor\n      .toArray()\n      .then((results: Model[]) =>\n        results.map((result) =>\n          this.resource.transform(result, this.connectedUser),\n        ),\n      );\n  }\n}\n","import { BaseModel, Criteria, Sort } from 'liwi-types';\nimport ResourceServerCursor from './ResourceServerCursor';\nimport Resource from './Resource';\n\nexport interface CreateCursorOptions<Model extends BaseModel> {\n  criteria?: Criteria<Model>;\n  sort?: Sort<Model>;\n  limit?: number;\n}\n\nexport default class ResourcesServerService {\n  resources: Map<string, Resource<any, any, any, any, any>>;\n\n  constructor(resources: Map<string, Resource<any, any, any, any, any>>) {\n    this.resources = resources;\n  }\n\n  addResource(key: string, resource: Resource<any, any, any, any, any>) {\n    this.resources.set(key, resource);\n  }\n\n  get(key: string) {\n    const resource = this.resources.get(key);\n    if (!resource) throw new Error(`Invalid rest resource: \"${key}\"`);\n    return resource;\n  }\n\n  async createCursor<Model extends BaseModel, Transformed, ConnectedUser>(\n    resource: Resource<Model, any, any, Transformed, ConnectedUser>,\n    connectedUser: ConnectedUser,\n    { criteria, sort, limit }: CreateCursorOptions<Model>,\n  ): Promise<ResourceServerCursor<Model, Transformed, ConnectedUser>> {\n    // TODO: resource.query(connectedUser, criteria || {}, sort).cursor()\n    criteria = resource.criteria(connectedUser, criteria || {});\n    sort = resource.sort(connectedUser, sort);\n    const cursor = await resource.store.cursor(criteria, sort);\n    limit = resource.limit(limit);\n    if (limit) cursor.limit(connectedUser, limit);\n    return new ResourceServerCursor(resource, cursor, connectedUser);\n  }\n}\n"],"names":["ResourceServerCursor","resource","cursor","connectedUser","toArray","then","results","map","result","transform","ResourcesServerService","resources","addResource","key","set","get","Error","createCursor","criteria","sort","limit","store"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAIqBA;;;gCAYjBC,QADF,EAEEC,MAFF,EAGEC,aAHF,EAIE;SACKF,QAAL,GAAgBA,QAAhB;SACKE,aAAL,GAAqBA,aAArB;SACKD,MAAL,GAAcA,MAAd;;;;;SAGFE,UAAA,mBAAkC;;;WACzB,KAAKF,MAAL,CACJE,OADI,GAEJC,IAFI,CAEC,UAACC,OAAD;aACJA,OAAO,CAACC,GAAR,CAAY,UAACC,MAAD;eACV,KAAI,CAACP,QAAL,CAAcQ,SAAd,CAAwBD,MAAxB,EAAgC,KAAI,CAACL,aAArC,CADU;OAAZ,CADI;KAFD,CAAP;;;;;;IChBiBO;;;kCAGPC,SAAZ,EAAuE;SAChEA,SAAL,GAAiBA,SAAjB;;;;;SAGFC,cAAA,qBAAYC,GAAZ,EAAyBZ,QAAzB,EAAsE;SAC/DU,SAAL,CAAeG,GAAf,CAAmBD,GAAnB,EAAwBZ,QAAxB;;;SAGFc,MAAA,aAAIF,GAAJ,EAAiB;QACTZ,QAAQ,GAAG,KAAKU,SAAL,CAAeI,GAAf,CAAmBF,GAAnB,CAAjB;QACI,CAACZ,QAAL,EAAe,MAAM,IAAIe,KAAJ,+BAAqCH,GAArC,QAAN;WACRZ,QAAP;;;SAGIgB;;;;;4BAAN,iBACEhB,QADF,EAEEE,aAFF;;;;;;cAGIe,QAHJ,QAGIA,QAHJ,EAGcC,IAHd,QAGcA,IAHd,EAGoBC,KAHpB,QAGoBA,KAHpB;;cAMEF,QAAQ,GAAGjB,QAAQ,CAACiB,QAAT,CAAkBf,aAAlB,EAAiCe,QAAQ,IAAI,EAA7C,CAAX;cACAC,IAAI,GAAGlB,QAAQ,CAACkB,IAAT,CAAchB,aAAd,EAA6BgB,IAA7B,CAAP;;qBACqBlB,QAAQ,CAACoB,KAAT,CAAenB,MAAf,CAAsBgB,QAAtB,EAAgCC,IAAhC,CARvB;;;cAQQjB,MARR;cASEkB,KAAK,GAAGnB,QAAQ,CAACmB,KAAT,CAAeA,KAAf,CAAR;kBACIA,KAAJ,EAAWlB,MAAM,CAACkB,KAAP,CAAajB,aAAb,EAA4BiB,KAA5B;+CACJ,IAAIpB,oBAAJ,CAAyBC,QAAzB,EAAmCC,MAAnC,EAA2CC,aAA3C,CAXT;;;;;;;;;;;;;;;;;;;;"}