{"version":3,"file":"index-node10-dev.cjs.js","sources":["../src/ResourceServerCursor.ts","../src/ResourcesServerService.ts"],"sourcesContent":["import { AbstractStoreCursor } from 'liwi-store';\nimport { BaseModel } from 'liwi-types';\nimport Resource from './Resource';\n\nexport default class ResourceServerCursor<\n  Model extends BaseModel,\n  Transformed = any,\n  ConnectedUser = any\n> {\n  private resource: Resource<Model, any, any, Transformed, ConnectedUser>;\n\n  private connectedUser: any;\n\n  private cursor: AbstractStoreCursor<Model, any, any>;\n\n  constructor(\n    resource: Resource<Model, any, any, Transformed, ConnectedUser>,\n    cursor: AbstractStoreCursor<Model, any, any>,\n    connectedUser?: ConnectedUser,\n  ) {\n    this.resource = resource;\n    this.connectedUser = connectedUser;\n    this.cursor = cursor;\n  }\n\n  toArray(): Promise<Transformed[]> {\n    return this.cursor\n      .toArray()\n      .then((results: Model[]) =>\n        results.map((result) =>\n          this.resource.transform(result, this.connectedUser),\n        ),\n      );\n  }\n}\n","import { BaseModel, Criteria, Sort } from 'liwi-types';\nimport ResourceServerCursor from './ResourceServerCursor';\nimport Resource from './Resource';\n\nexport interface CreateCursorOptions<Model extends BaseModel> {\n  criteria?: Criteria<Model>;\n  sort?: Sort<Model>;\n  limit?: number;\n}\n\nexport default class ResourcesServerService {\n  resources: Map<string, Resource<any, any, any, any, any>>;\n\n  constructor(resources: Map<string, Resource<any, any, any, any, any>>) {\n    this.resources = resources;\n  }\n\n  addResource(key: string, resource: Resource<any, any, any, any, any>) {\n    this.resources.set(key, resource);\n  }\n\n  get(key: string) {\n    const resource = this.resources.get(key);\n    if (!resource) throw new Error(`Invalid rest resource: \"${key}\"`);\n    return resource;\n  }\n\n  async createCursor<Model extends BaseModel, Transformed, ConnectedUser>(\n    resource: Resource<Model, any, any, Transformed, ConnectedUser>,\n    connectedUser: ConnectedUser,\n    { criteria, sort, limit }: CreateCursorOptions<Model>,\n  ): Promise<ResourceServerCursor<Model, Transformed, ConnectedUser>> {\n    // TODO: resource.query(connectedUser, criteria || {}, sort).cursor()\n    criteria = resource.criteria(connectedUser, criteria || {});\n    sort = resource.sort(connectedUser, sort);\n    const cursor = await resource.store.cursor(criteria, sort);\n    limit = resource.limit(limit);\n    if (limit) cursor.limit(connectedUser, limit);\n    return new ResourceServerCursor(resource, cursor, connectedUser);\n  }\n}\n"],"names":["ResourceServerCursor","constructor","resource","cursor","connectedUser","toArray","then","results","map","result","transform","ResourcesServerService","resources","addResource","key","set","get","Error","createCursor","criteria","sort","limit","store"],"mappings":";;;;AAIe,MAAMA,oBAAN,CAIb;EAOAC,WAAW,CACTC,QADS,EAETC,MAFS,EAGTC,aAHS,EAIT;SACKF,QAAL,GAAgBA,QAAhB;SACKE,aAAL,GAAqBA,aAArB;SACKD,MAAL,GAAcA,MAAd;;;EAGFE,OAAO,GAA2B;WACzB,KAAKF,MAAL,CACJE,OADI,GAEJC,IAFI,CAEEC,OAAD,IACJA,OAAO,CAACC,GAAR,CAAaC,MAAD,IACV,KAAKP,QAAL,CAAcQ,SAAd,CAAwBD,MAAxB,EAAgC,KAAKL,aAArC,CADF,CAHG,CAAP;;;;;AChBW,MAAMO,sBAAN,CAA6B;EAG1CV,WAAW,CAACW,SAAD,EAA4D;SAChEA,SAAL,GAAiBA,SAAjB;;;EAGFC,WAAW,CAACC,GAAD,EAAcZ,QAAd,EAA2D;SAC/DU,SAAL,CAAeG,GAAf,CAAmBD,GAAnB,EAAwBZ,QAAxB;;;EAGFc,GAAG,CAACF,GAAD,EAAc;UACTZ,QAAQ,GAAG,KAAKU,SAAL,CAAeI,GAAf,CAAmBF,GAAnB,CAAjB;QACI,CAACZ,QAAL,EAAe,MAAM,IAAIe,KAAJ,CAAW,2BAA0BH,GAAI,GAAzC,CAAN;WACRZ,QAAP;;;QAGIgB,YAAN,CACEhB,QADF,EAEEE,aAFF,EAGE;IAAEe,QAAF;IAAYC,IAAZ;IAAkBC;GAHpB,EAIoE;;IAElEF,QAAQ,GAAGjB,QAAQ,CAACiB,QAAT,CAAkBf,aAAlB,EAAiCe,QAAQ,IAAI,EAA7C,CAAX;IACAC,IAAI,GAAGlB,QAAQ,CAACkB,IAAT,CAAchB,aAAd,EAA6BgB,IAA7B,CAAP;UACMjB,MAAM,GAAG,MAAMD,QAAQ,CAACoB,KAAT,CAAenB,MAAf,CAAsBgB,QAAtB,EAAgCC,IAAhC,CAArB;IACAC,KAAK,GAAGnB,QAAQ,CAACmB,KAAT,CAAeA,KAAf,CAAR;QACIA,KAAJ,EAAWlB,MAAM,CAACkB,KAAP,CAAajB,aAAb,EAA4BiB,KAA5B;WACJ,IAAIrB,oBAAJ,CAAyBE,QAAzB,EAAmCC,MAAnC,EAA2CC,aAA3C,CAAP;;;;;;;"}