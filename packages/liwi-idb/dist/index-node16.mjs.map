{"version":3,"file":"index-node16.mjs","sources":["../src/index.ts"],"sourcesContent":["import type {\n  TransportClient,\n  TransportClientSubscribeResult,\n} from 'liwi-resources-client';\nimport type { ResourcesServerService } from 'liwi-resources-server';\nimport { createMessageHandler } from 'liwi-resources-server';\n\nexport interface DirectTransportClientOptions<AuthenticatedUser> {\n  resourcesServerService: ResourcesServerService;\n  authenticatedUser: AuthenticatedUser | null;\n}\n\nexport const createDirectTransportClient = <AuthenticatedUser>({\n  resourcesServerService,\n  authenticatedUser,\n}: DirectTransportClientOptions<AuthenticatedUser>): TransportClient => {\n  const { messageHandler, close } = createMessageHandler(\n    resourcesServerService,\n    authenticatedUser,\n    false,\n  );\n\n  const transportClient: TransportClient = {\n    connect: () => {},\n    close,\n    listenStateChange: () => {\n      return () => {};\n    },\n    send: (type, message) => {\n      return messageHandler({ type, id: 0, payload: message } as any, () => {\n        throw new Error('Unsupported');\n      }) as any;\n    },\n\n    subscribe: (type, messageWithoutSubscriptionId, callback) => {\n      const message = { ...messageWithoutSubscriptionId, subscriptionId: 0 };\n\n      const p: TransportClientSubscribeResult<any, any> = messageHandler(\n        { type, id: 0, payload: message } as any,\n        () => {},\n      ).then(\n        (result) => {\n          callback(null, result as any);\n        },\n        (err) => {\n          (callback as any)(err);\n        },\n      ) as any;\n\n      p.then();\n      p.stop = () => {};\n      p.cancel = () => {};\n      return p;\n    },\n  };\n\n  return transportClient;\n};\n"],"names":["createDirectTransportClient","resourcesServerService","authenticatedUser","messageHandler","close","createMessageHandler","connect","listenStateChange","send","type","message","id","payload","Error","subscribe","messageWithoutSubscriptionId","callback","subscriptionId","p","then","result","err","stop","cancel"],"mappings":";;AAYO,MAAMA,2BAA2B,GAAG,CAAoB;EAC7DC,sBAAsB;AACtBC,EAAAA,iBAAAA;AAC+C,CAAC,KAAsB;EACtE,MAAM;IAAEC,cAAc;AAAEC,IAAAA,KAAAA;GAAO,GAAGC,oBAAoB,CACpDJ,sBAAsB,EACtBC,iBAAiB,EACjB,KAAK,CACN,CAAA;EAoCD,OAlCyC;IACvCI,OAAO,EAAE,MAAM,EAAE;IACjBF,KAAK;AACLG,IAAAA,iBAAiB,EAAE,MAAM;MACvB,OAAO,MAAM,EAAE,CAAA;KAChB;AACDC,IAAAA,IAAI,EAAE,CAACC,IAAI,EAAEC,OAAO,KAAK;AACvB,MAAA,OAAOP,cAAc,CAAC;QAAEM,IAAI;AAAEE,QAAAA,EAAE,EAAE,CAAC;AAAEC,QAAAA,OAAO,EAAEF,OAAAA;AAAQ,OAAC,EAAS,MAAM;AACpE,QAAA,MAAM,IAAIG,KAAK,CAAC,aAAa,CAAC,CAAA;AAChC,OAAC,CAAC,CAAA;KACH;AAEDC,IAAAA,SAAS,EAAE,CAACL,IAAI,EAAEM,4BAA4B,EAAEC,QAAQ,KAAK;AAC3D,MAAA,MAAMN,OAAO,GAAG;AAAE,QAAA,GAAGK,4BAA4B;AAAEE,QAAAA,cAAc,EAAE,CAAA;OAAG,CAAA;MAEtE,MAAMC,CAA2C,GAAGf,cAAc,CAChE;QAAEM,IAAI;AAAEE,QAAAA,EAAE,EAAE,CAAC;AAAEC,QAAAA,OAAO,EAAEF,OAAAA;OAAS,EACjC,MAAM,EAAE,CACT,CAACS,IAAI,CACHC,MAAM,IAAK;AACVJ,QAAAA,QAAQ,CAAC,IAAI,EAAEI,MAAM,CAAQ,CAAA;OAC9B,EACAC,GAAG,IAAK;QACNL,QAAQ,CAASK,GAAG,CAAC,CAAA;AACxB,OAAC,CACK,CAAA;MAERH,CAAC,CAACC,IAAI,EAAE,CAAA;AACRD,MAAAA,CAAC,CAACI,IAAI,GAAG,MAAM,EAAE,CAAA;AACjBJ,MAAAA,CAAC,CAACK,MAAM,GAAG,MAAM,EAAE,CAAA;AACnB,MAAA,OAAOL,CAAC,CAAA;AACV,KAAA;GACD,CAAA;AAGH;;;;"}