{"version":3,"file":"index-browsermodern-dev.es.js","sources":["../src/Find.ts","../src/applyChanges.ts","../src/FindAndSubscribe.ts","../src/reducer.ts","../src/hooks/useRetrieveResource.ts","../src/hooks/useRetrieveResourceAndSubscribe.ts","../src/hooks/useResources.ts","../src/hooks/useResource.ts"],"sourcesContent":["import React, { Component, ReactNode, ComponentType } from 'react';\nimport { AbstractQuery } from 'liwi-store';\nimport { BaseModel } from 'liwi-types';\n\ninterface LoadingProps {}\n\ntype Record<K extends string, T> = { [P in K]: T };\n\ninterface Props<Name extends string, Value> {\n  component: ComponentType<Record<Name, Value[]>>;\n  loadingComponent?: ComponentType<LoadingProps>;\n  name: Name;\n  query: AbstractQuery<Value>;\n}\n\ninterface State<Result> {\n  fetched: boolean;\n  result: Result | undefined;\n}\n\nexport default class FindComponent<\n  Name extends string,\n  Model extends BaseModel\n> extends Component<Props<Name, Model>, State<Model[]>> {\n  state = {\n    fetched: false,\n    result: undefined,\n  };\n\n  // eslint-disable-next-line react/sort-comp\n  _find?: Promise<void>;\n\n  componentDidMount() {\n    const { query } = this.props;\n    this._find = query.fetch((result: Model[]) => {\n      if (!this._find) return;\n      this.setState({\n        fetched: true,\n        result,\n      });\n      delete this._find;\n    });\n  }\n\n  componentWillUnmount() {\n    if (this._find) {\n      // this._find.cancel();\n      delete this._find;\n    }\n  }\n\n  render(): ReactNode {\n    if (!this.state.fetched) {\n      return this.props.loadingComponent\n        ? React.createElement(this.props.loadingComponent)\n        : null;\n    }\n\n    return React.createElement(this.props.component, {\n      [this.props.name]: this.state.result,\n    } as any);\n  }\n}\n","/* eslint-disable camelcase, complexity */\nimport { Change, Changes } from 'liwi-types';\n\nconst copy = <Value>(state: Value[]): Value[] => state.slice();\n\nconst applyChange = <\n  KeyPath extends string,\n  Value extends { [K in KeyPath]: any }\n>(\n  state: Value[],\n  change: Change<Value>,\n  keyPath: KeyPath,\n): Value[] => {\n  switch (change.type) {\n    case 'initial':\n      return change.initial;\n\n    case 'inserted': {\n      return [...change.objects, ...state.slice(0, -change.objects.length)];\n    }\n\n    case 'deleted': {\n      const deletedKeys = change.keys;\n      return state.filter((value) => !deletedKeys.includes(value[keyPath]));\n    }\n\n    case 'updated': {\n      const newState = copy(state);\n      change.objects.forEach((newObject) => {\n        const index = newState.findIndex(\n          (o: Value) => o[keyPath] === newObject[keyPath],\n        );\n        if (index === -1) return;\n        newState[index] = newObject;\n      });\n      return newState;\n    }\n\n    default:\n      throw new Error('Invalid type');\n  }\n};\n\n// https://github.com/rethinkdb/horizon/blob/next/client/src/ast.js\nexport default <Value>(\n  state: undefined | Value[],\n  changes: Changes<Value>,\n  keyPath: string,\n): undefined | Value[] => {\n  if (changes.length === 1) {\n    const firstChange = changes[0];\n    if (firstChange.type === 'initial') {\n      return firstChange.initial;\n    }\n  }\n\n  if (state === undefined) return state;\n\n  return changes.reduce(\n    (stateValue: Value[], change: Change<Value>) =>\n      applyChange(stateValue, change, keyPath),\n    state,\n  );\n};\n","import React, { Component, ReactNode, ComponentType } from 'react';\nimport Logger from 'nightingale-logger';\nimport { Changes } from 'liwi-types';\nimport { AbstractQuery, SubscribeResult } from 'liwi-store';\nimport applyChanges from './applyChanges';\n\ninterface LoadingProps {}\n\ninterface Props<Name extends string, Value, CreateQueryParams> {\n  component: ComponentType<{ [P in Name]: Value[] }>;\n  loadingComponent?: ComponentType<LoadingProps>;\n  name: Name;\n  createQuery: (params: CreateQueryParams) => AbstractQuery<Value>;\n  params: CreateQueryParams;\n  visibleTimeout?: number;\n}\n\ninterface State<Result> {\n  fetched: boolean;\n  result: Result | undefined;\n}\n\nconst logger = new Logger('react-liwi:FindAndSubscribe');\n\nexport default class FindAndSubscribeComponent<\n  Name extends string,\n  Value,\n  CreateQueryParams\n> extends Component<Props<Name, Value, CreateQueryParams>, State<Value[]>> {\n  static defaultProps = {\n    visibleTimeout: 1000 * 60 * 2, // 2 minutes\n  };\n\n  state = {\n    fetched: false,\n    result: undefined,\n  };\n\n  private timeout: number | undefined = undefined;\n\n  private _subscribe: SubscribeResult<Value[]> | undefined = undefined;\n\n  // eslint-disable-next-line react/sort-comp\n  private query?: AbstractQuery<Value>;\n\n  componentDidMount() {\n    this.query = this.props.createQuery(this.props.params);\n    if (!document.hidden) {\n      this.subscribe(this.query);\n    }\n    document.addEventListener(\n      'visibilitychange',\n      this.handleVisibilityChange,\n      false,\n    );\n  }\n\n  componentWillUnmount() {\n    if (this.timeout) {\n      clearTimeout(this.timeout);\n    }\n\n    this.unsubscribe();\n  }\n\n  private handleVisibilityChange = () => {\n    if (!document.hidden) {\n      if (this.timeout !== undefined) {\n        logger.info('timeout cleared', {\n          name: this.props.name,\n        });\n        clearTimeout(this.timeout);\n        this.timeout = undefined;\n      } else {\n        logger.info('resubscribe', {\n          name: this.props.name,\n        });\n        this.subscribe(this.query as AbstractQuery<Value>);\n      }\n      return;\n    }\n\n    if (this._subscribe === undefined) return;\n\n    logger.log('timeout visible', {\n      name: this.props.name,\n    });\n    this.timeout = setTimeout(this.unsubscribe, this.props.visibleTimeout);\n  };\n\n  private subscribe = (query: AbstractQuery<Value>): void => {\n    this._subscribe = query.fetchAndSubscribe(\n      (err: Error | null, changes: Changes<Value>) => {\n        if (err) {\n          // eslint-disable-next-line no-alert\n          alert(`Unexpected error: ${err}`);\n          return;\n        }\n\n        const newResult = applyChanges(\n          this.state.result,\n          changes,\n          '_id', // TODO get keyPath from client(/store)\n        );\n\n        if (!this.state.fetched) {\n          this.setState({ fetched: true, result: newResult });\n        } else if (newResult !== this.state.result) {\n          this.setState({ result: newResult });\n        }\n      },\n    );\n  };\n\n  private unsubscribe = (): void => {\n    logger.log('unsubscribe due to timeout visible', {\n      name: this.props.name,\n    });\n\n    // reset timeout to allow resubscribing\n    this.timeout = undefined;\n\n    if (this._subscribe) {\n      this._subscribe.stop();\n      this._subscribe = undefined;\n    }\n  };\n\n  render(): ReactNode {\n    if (!this.state.fetched) {\n      return this.props.loadingComponent\n        ? React.createElement(this.props.loadingComponent)\n        : null;\n    }\n\n    return React.createElement(this.props.component, {\n      [this.props.name]: this.state.result,\n    } as any);\n  }\n}\n","import { Reducer } from 'react';\n\nexport interface InitialState {\n  fetched: false;\n  promise: Promise<void>;\n}\n\nexport interface FetchedState<Result> {\n  fetched: true;\n  result: Result;\n}\n\nexport interface InitAction {\n  type: 'init';\n}\n\nexport interface ResolveAction<Result> {\n  type: 'resolve';\n  result: Result;\n}\n\nexport type Action<Result> = ResolveAction<Result>;\nexport type State<Result> = InitialState | FetchedState<Result>;\nexport type Reducer<Result> = Reducer<State<Result>, Action<Result>>;\n\nexport function initReducer(initializer: () => Promise<void>): InitialState {\n  return {\n    fetched: false,\n    promise: initializer(),\n  };\n}\n\nexport default function reducer<Result>(\n  state: State<Result>,\n  action: Action<Result>,\n): State<Result> {\n  switch (action.type) {\n    case 'resolve':\n      return {\n        fetched: true,\n        result: action.result,\n      };\n    default:\n      throw new Error('Invalid action');\n  }\n}\n","import { useReducer } from 'react';\nimport { BaseModel } from 'liwi-types';\nimport { AbstractQuery } from 'liwi-store';\nimport reducer, { initReducer, Reducer } from '../reducer';\n\nexport default function useRetrieveResource<Model extends BaseModel>(\n  createQuery: () => AbstractQuery<Model>,\n) {\n  const [state, dispatch] = useReducer<Reducer<Model[]>, () => Promise<void>>(\n    reducer,\n    () =>\n      createQuery().fetch((result: Model[]) => {\n        (state as any).resolve();\n        dispatch({ type: 'resolve', result });\n      }),\n    initReducer,\n  );\n\n  return state;\n}\n","import { useEffect, useReducer, useRef } from 'react';\nimport { BaseModel, Changes } from 'liwi-types';\nimport { AbstractQuery, SubscribeResult } from 'liwi-store';\nimport Logger from 'nightingale-logger';\nimport applyChanges from '../applyChanges';\nimport reducer, { Reducer, initReducer } from '../reducer';\n\ninterface UseResourceAndSubscribeOptions {\n  visibleTimeout: number;\n}\n\nconst defaultOptions = {\n  visibleTimeout: 1000 * 60 * 2, // 2 minutes\n};\n\nconst logger = new Logger('react-liwi:useResourceAndSubscribe');\n\nexport default function useRetrieveResourceAndSubscribe<\n  Model extends BaseModel\n>(\n  createQuery: () => AbstractQuery<Model>,\n  { visibleTimeout }: UseResourceAndSubscribeOptions = defaultOptions,\n) {\n  const subscribeResultRef = useRef<SubscribeResult<Model[]> | undefined>(\n    undefined,\n  );\n  const timeoutRef = useRef<ReturnType<typeof setTimeout> | undefined>(\n    undefined,\n  );\n  const resultRef = useRef<Model[] | undefined>(undefined);\n\n  const unsubscribe = (): void => {\n    logger.log('unsubscribe');\n\n    // reset timeout to allow resubscribing\n    timeoutRef.current = undefined;\n    resultRef.current = undefined;\n\n    if (subscribeResultRef.current) {\n      subscribeResultRef.current.stop();\n      subscribeResultRef.current = undefined;\n    }\n  };\n\n  const [state, dispatch] = useReducer<Reducer<Model[]>, () => Promise<void>>(\n    reducer,\n    () =>\n      new Promise((resolve, reject) => {\n        const query = createQuery();\n        const queryLogger = logger.context({\n          resourceName: (query as any).client.resourceName,\n          key: (query as any).key,\n        });\n        queryLogger.debug('init');\n\n        const subscribe = (): void => {\n          queryLogger.debug('subscribing', {\n            subscribeResultRef: subscribeResultRef.current,\n            timeoutRef: timeoutRef.current,\n          });\n          subscribeResultRef.current = query.fetchAndSubscribe(\n            (err: Error | null, changes: Changes<Model>) => {\n              queryLogger.debug('received changes', {\n                err,\n                changes,\n              });\n              if (err) {\n                // eslint-disable-next-line no-alert\n                alert(`Unexpected error: ${err}`);\n                return;\n              }\n\n              const currentResult = resultRef.current;\n              const newResult = applyChanges(\n                currentResult,\n                changes,\n                '_id', // TODO get keyPath from client(/store)\n              );\n\n              if (newResult && newResult !== currentResult) {\n                resultRef.current = newResult;\n                dispatch({ type: 'resolve', result: newResult });\n              }\n            },\n          );\n        };\n\n        const handleVisibilityChange = () => {\n          if (!document.hidden) {\n            if (timeoutRef.current !== undefined) {\n              queryLogger.debug('timeout cleared');\n              clearTimeout(timeoutRef.current);\n              timeoutRef.current = undefined;\n            } else if (!subscribeResultRef.current) {\n              queryLogger.info('resubscribe');\n              subscribe();\n            }\n            return;\n          }\n\n          if (subscribeResultRef.current === undefined) return;\n\n          queryLogger.debug('timeout visible');\n          timeoutRef.current = setTimeout(unsubscribe, visibleTimeout);\n        };\n\n        document.addEventListener(\n          'visibilitychange',\n          handleVisibilityChange,\n          false,\n        );\n\n        if (!document.hidden) {\n          subscribe();\n        }\n      }),\n    initReducer,\n  );\n\n  useEffect(() => {\n    return () => {\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n        timeoutRef.current = undefined;\n      }\n\n      unsubscribe();\n    };\n  }, []);\n\n  return state;\n}\n","/* eslint-disable import/export */\n\nimport { POB_TARGET } from 'pob-babel';\nimport { AbstractQuery } from 'liwi-store';\nimport { BaseModel } from 'liwi-types';\nimport { InitialState, FetchedState } from '../reducer';\nimport useRetrieveResource from './useRetrieveResource';\nimport useRetrieveResourceAndSubscribe from './useRetrieveResourceAndSubscribe';\n\ntype CreateQuery<M extends BaseModel> = () => AbstractQuery<M>;\ntype UseResourceResult<Results> = [true, []] | [false, Results];\n\nexport default function useResources<T1 extends BaseModel>(\n  createQueries: [CreateQuery<T1>],\n  queriesToSubscribe: [boolean],\n): UseResourceResult<[T1[]]>;\nexport default function useResources<\n  T1 extends BaseModel,\n  T2 extends BaseModel\n>(\n  createQueries: [CreateQuery<T1>, CreateQuery<T2>],\n  queriesToSubscribe: [boolean, boolean],\n): UseResourceResult<[T1[], T2[]]>;\nexport default function useResources<\n  T1 extends BaseModel,\n  T2 extends BaseModel,\n  T3 extends BaseModel\n>(\n  createQueries: [CreateQuery<T1>, CreateQuery<T2>, CreateQuery<T3>],\n  queriesToSubscribe: [boolean, boolean, boolean],\n): UseResourceResult<[T1[], T2[], T3[]]>;\nexport default function useResources<\n  T1 extends BaseModel,\n  T2 extends BaseModel,\n  T3 extends BaseModel,\n  T4 extends BaseModel\n>(\n  createQueries: [\n    CreateQuery<T1>,\n    CreateQuery<T2>,\n    CreateQuery<T3>,\n    CreateQuery<T4>\n  ],\n  queriesToSubscribe: [boolean, boolean, boolean, boolean],\n): UseResourceResult<[T1[], T2[], T3[], T4[]]>;\nexport default function useResources<\n  T1 extends BaseModel,\n  T2 extends BaseModel,\n  T3 extends BaseModel,\n  T4 extends BaseModel,\n  T5 extends BaseModel\n>(\n  createQueries: [\n    CreateQuery<T1>,\n    CreateQuery<T2>,\n    CreateQuery<T3>,\n    CreateQuery<T4>,\n    CreateQuery<T5>\n  ],\n  queriesToSubscribe: [boolean, boolean, boolean, boolean, boolean],\n): UseResourceResult<[T1[], T2[], T3[], T4[], T5[]]>;\nexport default function useResources<T extends BaseModel>(\n  createQueries: (CreateQuery<T>)[],\n  queriesToSubscribe: boolean[],\n): UseResourceResult<T[][]> {\n  if (POB_TARGET === 'node') return [true, []];\n\n  const states = createQueries.map((createQuery, index) => {\n    return queriesToSubscribe[index]\n      ? // eslint-disable-next-line react-hooks/rules-of-hooks\n        useRetrieveResourceAndSubscribe(createQuery)\n      : // eslint-disable-next-line react-hooks/rules-of-hooks\n        useRetrieveResource(createQuery);\n  });\n\n  const nonFetchedStates: InitialState[] = states.filter(\n    (state) => !state.fetched,\n  ) as InitialState[];\n\n  if (nonFetchedStates.length !== 0) {\n    return [true, []];\n  }\n\n  return [false, states.map((state) => (state as FetchedState<any>).result)];\n}\n","import { POB_TARGET } from 'pob-babel';\nimport { AbstractQuery } from 'liwi-store';\nimport { BaseModel } from 'liwi-types';\nimport useRetrieveResource from './useRetrieveResource';\nimport useRetrieveResourceAndSubscribe from './useRetrieveResourceAndSubscribe';\n\ntype UseResourceResult<Result> = [true, undefined] | [false, Result];\n\nexport default function useResource<Model extends BaseModel>(\n  createQuery: () => AbstractQuery<Model>,\n  subscribe: boolean,\n): UseResourceResult<Model[]> {\n  if (POB_TARGET === 'node') return [true, undefined];\n\n  const state = subscribe\n    ? // eslint-disable-next-line react-hooks/rules-of-hooks\n      useRetrieveResourceAndSubscribe(createQuery)\n    : // eslint-disable-next-line react-hooks/rules-of-hooks\n      useRetrieveResource(createQuery);\n\n  if (!state.fetched) {\n    return [true, undefined];\n  }\n\n  return [false, state.result];\n}\n"],"names":["FindComponent","Component","state","fetched","result","undefined","componentDidMount","query","props","_find","fetch","setState","componentWillUnmount","render","loadingComponent","React","createElement","component","name","copy","slice","applyChange","change","keyPath","type","initial","objects","length","deletedKeys","keys","filter","value","includes","newState","forEach","newObject","index","findIndex","o","Error","changes","firstChange","reduce","stateValue","logger","Logger","FindAndSubscribeComponent","timeout","_subscribe","handleVisibilityChange","document","hidden","info","clearTimeout","subscribe","log","setTimeout","unsubscribe","visibleTimeout","fetchAndSubscribe","err","alert","newResult","applyChanges","stop","createQuery","params","addEventListener","defaultProps","initReducer","initializer","promise","reducer","action","useRetrieveResource","dispatch","useReducer","resolve","defaultOptions","useRetrieveResourceAndSubscribe","subscribeResultRef","useRef","timeoutRef","resultRef","current","Promise","queryLogger","context","resourceName","client","key","debug","currentResult","useEffect","useResources","createQueries","queriesToSubscribe","states","map","nonFetchedStates","useResource"],"mappings":"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"}