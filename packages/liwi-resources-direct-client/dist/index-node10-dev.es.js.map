{"version":3,"file":"index-node10-dev.es.js","sources":["../src/index.ts"],"sourcesContent":["import {\n  TransportClient,\n  TransportClientSubscribeResult,\n} from 'liwi-resources-client';\nimport {\n  ResourcesServerService,\n  createMessageHandler,\n} from 'liwi-resources-server';\n\nexport interface DirectTransportClientOptions<AuthenticatedUser> {\n  resourcesServerService: ResourcesServerService;\n  authenticatedUser: AuthenticatedUser | null;\n}\n\nexport const createDirectTransportClient = <AuthenticatedUser>({\n  resourcesServerService,\n  authenticatedUser,\n}: DirectTransportClientOptions<AuthenticatedUser>): TransportClient => {\n  const { messageHandler, close } = createMessageHandler(\n    resourcesServerService,\n    authenticatedUser,\n    false,\n  );\n\n  const transportClient: TransportClient = {\n    connect: () => {},\n    close,\n    listenStateChange: () => {\n      return () => {};\n    },\n    send: (type, message) => {\n      return messageHandler({ type, id: 0, payload: message } as any, () => {\n        throw new Error('Unsupported');\n      }) as any;\n    },\n\n    subscribe: (type, messageWithoutSubscriptionId, callback) => {\n      const message = { ...messageWithoutSubscriptionId, subscriptionId: 0 };\n\n      const p: TransportClientSubscribeResult<any, any> = messageHandler(\n        { type, id: 0, payload: message } as any,\n        () => {},\n      ).then(\n        (result) => {\n          callback(null, result as any);\n        },\n        (err) => {\n          (callback as any)(err);\n        },\n      ) as any;\n\n      p.then();\n      p.stop = () => {};\n      p.cancel = () => {};\n      return p;\n    },\n  };\n\n  return transportClient;\n};\n"],"names":["createDirectTransportClient","resourcesServerService","authenticatedUser","messageHandler","close","createMessageHandler","connect","listenStateChange","send","type","message","id","payload","Error","subscribe","messageWithoutSubscriptionId","callback","subscriptionId","p","then","result","err","stop","cancel"],"mappings":";;MAcaA,2BAA2B,GAAG,CAAoB;AAC7DC,EAAAA,sBAD6D;AAE7DC,EAAAA;AAF6D,CAApB,KAG6B;AACtE,QAAM;AAAEC,IAAAA,cAAF;AAAkBC,IAAAA;AAAlB,MAA4BC,oBAAoB,CACpDJ,sBADoD,EAEpDC,iBAFoD,EAGpD,KAHoD,CAAtD;AAwCA,SAlCyC;AACvCI,IAAAA,OAAO,EAAE,MAAM,EADwB;AAEvCF,IAAAA,KAFuC;AAGvCG,IAAAA,iBAAiB,EAAE,MAAM;AACvB,aAAO,MAAM,EAAb;AACD,KALsC;AAMvCC,IAAAA,IAAI,EAAE,CAACC,IAAD,EAAOC,OAAP,KAAmB;AACvB,aAAOP,cAAc,CAAC;AAAEM,QAAAA,IAAF;AAAQE,QAAAA,EAAE,EAAE,CAAZ;AAAeC,QAAAA,OAAO,EAAEF;AAAxB,OAAD,EAA2C,MAAM;AACpE,cAAM,IAAIG,KAAJ,CAAU,aAAV,CAAN;AACD,OAFoB,CAArB;AAGD,KAVsC;AAYvCC,IAAAA,SAAS,EAAE,CAACL,IAAD,EAAOM,4BAAP,EAAqCC,QAArC,KAAkD;AAC3D,YAAMN,OAAO,GAAG,EAAE,GAAGK,4BAAL;AAAmCE,QAAAA,cAAc,EAAE;AAAnD,OAAhB;AAEA,YAAMC,CAA2C,GAAGf,cAAc,CAChE;AAAEM,QAAAA,IAAF;AAAQE,QAAAA,EAAE,EAAE,CAAZ;AAAeC,QAAAA,OAAO,EAAEF;AAAxB,OADgE,EAEhE,MAAM,EAF0D,CAAd,CAGlDS,IAHkD,CAIjDC,MAAD,IAAY;AACVJ,QAAAA,QAAQ,CAAC,IAAD,EAAOI,MAAP,CAAR;AACD,OANiD,EAOjDC,GAAD,IAAS;AACNL,QAAAA,QAAD,CAAkBK,GAAlB;AACD,OATiD,CAApD;AAYAH,MAAAA,CAAC,CAACC,IAAF;;AACAD,MAAAA,CAAC,CAACI,IAAF,GAAS,MAAM,EAAf;;AACAJ,MAAAA,CAAC,CAACK,MAAF,GAAW,MAAM,EAAjB;;AACA,aAAOL,CAAP;AACD;AA/BsC,GAkCzC;AACD;;;;"}