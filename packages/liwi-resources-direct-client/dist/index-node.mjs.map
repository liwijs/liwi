{"version":3,"file":"index-node.mjs","sources":["../src/index.ts"],"sourcesContent":["import type {\n  TransportClient,\n  TransportClientSubscribeResult,\n} from \"liwi-resources-client\";\nimport type { ResourcesServerService } from \"liwi-resources-server\";\nimport { createMessageHandler } from \"liwi-resources-server\";\n\nexport interface DirectTransportClientOptions<AuthenticatedUser> {\n  resourcesServerService: ResourcesServerService;\n  authenticatedUser: AuthenticatedUser | null;\n}\n\nexport const createDirectTransportClient = <AuthenticatedUser>({\n  resourcesServerService,\n  authenticatedUser,\n}: DirectTransportClientOptions<AuthenticatedUser>): TransportClient => {\n  const { messageHandler, close } = createMessageHandler(\n    resourcesServerService,\n    authenticatedUser,\n    false,\n  );\n\n  const transportClient: TransportClient = {\n    connect: () => {},\n    close,\n    listenStateChange: () => {\n      return () => {};\n    },\n    send: (type, message) => {\n      return messageHandler({ type, id: 0, payload: message } as any, () => {\n        throw new Error(\"Unsupported\");\n      }) as any;\n    },\n\n    subscribe: (type, messageWithoutSubscriptionId, callback) => {\n      const message = { ...messageWithoutSubscriptionId, subscriptionId: 0 };\n\n      const p: TransportClientSubscribeResult<any, any> = messageHandler(\n        { type, id: 0, payload: message } as any,\n        () => {},\n      ).then(\n        (result) => {\n          callback(null, result as any);\n        },\n        (error) => {\n          (callback as any)(error);\n        },\n      ) as any;\n\n      p.then();\n      p.stop = () => {};\n      p.cancel = () => {};\n      return p;\n    },\n  };\n\n  return transportClient;\n};\n"],"names":[],"mappings":";;AAYO,MAAM,8BAA8B,CAAoB;AAAA,EAC7D,sBAAA;AAAA,EACA;AACF,CAAA,KAAwE;AACtE,EAAA,MAAM,EAAE,cAAA,EAAgB,KAAA,EAAM,GAAI,oBAAA;AAAA,IAChC,sBAAA;AAAA,IACA,iBAAA;AAAA,IACA;AAAA,GACF;AAEA,EAAA,MAAM,eAAA,GAAmC;AAAA,IACvC,SAAS,MAAM;AAAA,IAAC,CAAA;AAAA,IAChB,KAAA;AAAA,IACA,mBAAmB,MAAM;AACvB,MAAA,OAAO,MAAM;AAAA,MAAC,CAAA;AAAA,IAChB,CAAA;AAAA,IACA,IAAA,EAAM,CAAC,IAAA,EAAM,OAAA,KAAY;AACvB,MAAA,OAAO,cAAA,CAAe,EAAE,IAAA,EAAM,EAAA,EAAI,GAAG,OAAA,EAAS,OAAA,IAAkB,MAAM;AACpE,QAAA,MAAM,IAAI,MAAM,aAAa,CAAA;AAAA,MAC/B,CAAC,CAAA;AAAA,IACH,CAAA;AAAA,IAEA,SAAA,EAAW,CAAC,IAAA,EAAM,4BAAA,EAA8B,QAAA,KAAa;AAC3D,MAAA,MAAM,OAAA,GAAU,EAAE,GAAG,4BAAA,EAA8B,gBAAgB,CAAA,EAAE;AAErE,MAAA,MAAM,CAAA,GAA8C,cAAA;AAAA,QAClD,EAAE,IAAA,EAAM,EAAA,EAAI,CAAA,EAAG,SAAS,OAAA,EAAQ;AAAA,QAChC,MAAM;AAAA,QAAC;AAAA,OACT,CAAE,IAAA;AAAA,QACA,CAAC,MAAA,KAAW;AACV,UAAA,QAAA,CAAS,MAAM,MAAa,CAAA;AAAA,QAC9B,CAAA;AAAA,QACA,CAAC,KAAA,KAAU;AACT,UAAC,SAAiB,KAAK,CAAA;AAAA,QACzB;AAAA,OACF;AAEA,MAAA,CAAA,CAAE,IAAA,EAAK;AACP,MAAA,CAAA,CAAE,OAAO,MAAM;AAAA,MAAC,CAAA;AAChB,MAAA,CAAA,CAAE,SAAS,MAAM;AAAA,MAAC,CAAA;AAClB,MAAA,OAAO,CAAA;AAAA,IACT;AAAA,GACF;AAEA,EAAA,OAAO,eAAA;AACT;;;;"}