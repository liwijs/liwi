{"version":3,"file":"index-node14.mjs","sources":["../src/index.ts"],"sourcesContent":["import type {\n  TransportClient,\n  TransportClientSubscribeResult,\n} from 'liwi-resources-client';\nimport type { ResourcesServerService } from 'liwi-resources-server';\nimport { createMessageHandler } from 'liwi-resources-server';\n\nexport interface DirectTransportClientOptions<AuthenticatedUser> {\n  resourcesServerService: ResourcesServerService;\n  authenticatedUser: AuthenticatedUser | null;\n}\n\nexport const createDirectTransportClient = <AuthenticatedUser>({\n  resourcesServerService,\n  authenticatedUser,\n}: DirectTransportClientOptions<AuthenticatedUser>): TransportClient => {\n  const { messageHandler, close } = createMessageHandler(\n    resourcesServerService,\n    authenticatedUser,\n    false,\n  );\n\n  const transportClient: TransportClient = {\n    connect: () => {},\n    close,\n    listenStateChange: () => {\n      return () => {};\n    },\n    send: (type, message) => {\n      return messageHandler({ type, id: 0, payload: message } as any, () => {\n        throw new Error('Unsupported');\n      }) as any;\n    },\n\n    subscribe: (type, messageWithoutSubscriptionId, callback) => {\n      const message = { ...messageWithoutSubscriptionId, subscriptionId: 0 };\n\n      const p: TransportClientSubscribeResult<any, any> = messageHandler(\n        { type, id: 0, payload: message } as any,\n        () => {},\n      ).then(\n        (result) => {\n          callback(null, result as any);\n        },\n        (err) => {\n          (callback as any)(err);\n        },\n      ) as any;\n\n      p.then();\n      p.stop = () => {};\n      p.cancel = () => {};\n      return p;\n    },\n  };\n\n  return transportClient;\n};\n"],"names":["createDirectTransportClient","resourcesServerService","authenticatedUser","messageHandler","close","createMessageHandler","connect","listenStateChange","send","type","message","id","payload","Error","subscribe","messageWithoutSubscriptionId","callback","subscriptionId","p","then","result","err","stop","cancel"],"mappings":";;AAYO,MAAMA,2BAA2B,GAAG,CAAoB;EAC7DC,sBAD6D;AAE7DC,EAAAA,iBAAAA;AAF6D,CAApB,KAG6B;EACtE,MAAM;IAAEC,cAAF;AAAkBC,IAAAA,KAAAA;AAAlB,GAAA,GAA4BC,oBAAoB,CACpDJ,sBADoD,EAEpDC,iBAFoD,EAGpD,KAHoD,CAAtD,CAAA;EAwCA,OAlCyC;IACvCI,OAAO,EAAE,MAAM,EADwB;IAEvCF,KAFuC;AAGvCG,IAAAA,iBAAiB,EAAE,MAAM;MACvB,OAAO,MAAM,EAAb,CAAA;KAJqC;AAMvCC,IAAAA,IAAI,EAAE,CAACC,IAAD,EAAOC,OAAP,KAAmB;AACvB,MAAA,OAAOP,cAAc,CAAC;QAAEM,IAAF;AAAQE,QAAAA,EAAE,EAAE,CAAZ;AAAeC,QAAAA,OAAO,EAAEF,OAAAA;AAAxB,OAAD,EAA2C,MAAM;AACpE,QAAA,MAAM,IAAIG,KAAJ,CAAU,aAAV,CAAN,CAAA;AACD,OAFoB,CAArB,CAAA;KAPqC;AAYvCC,IAAAA,SAAS,EAAE,CAACL,IAAD,EAAOM,4BAAP,EAAqCC,QAArC,KAAkD;AAC3D,MAAA,MAAMN,OAAO,GAAG,EAAE,GAAGK,4BAAL;AAAmCE,QAAAA,cAAc,EAAE,CAAA;OAAnE,CAAA;MAEA,MAAMC,CAA2C,GAAGf,cAAc,CAChE;QAAEM,IAAF;AAAQE,QAAAA,EAAE,EAAE,CAAZ;AAAeC,QAAAA,OAAO,EAAEF,OAAAA;OADwC,EAEhE,MAAM,EAF0D,CAAd,CAGlDS,IAHkD,CAIjDC,MAAD,IAAY;AACVJ,QAAAA,QAAQ,CAAC,IAAD,EAAOI,MAAP,CAAR,CAAA;OALgD,EAOjDC,GAAD,IAAS;AACNL,QAAAA,QAAD,CAAkBK,GAAlB,CAAA,CAAA;AACD,OATiD,CAApD,CAAA;AAYAH,MAAAA,CAAC,CAACC,IAAF,EAAA,CAAA;;AACAD,MAAAA,CAAC,CAACI,IAAF,GAAS,MAAM,EAAf,CAAA;;AACAJ,MAAAA,CAAC,CAACK,MAAF,GAAW,MAAM,EAAjB,CAAA;;AACA,MAAA,OAAOL,CAAP,CAAA;AACD,KAAA;GAGH,CAAA;AACD;;;;"}