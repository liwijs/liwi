{"version":3,"file":"index-browser.es.js","sources":["../src/AbstractConnection.ts","../src/AbstractCursor.ts","../src/AbstractStoreCursor.ts"],"sourcesContent":["export default abstract class AbstractConnection {\n  abstract getConnection(): Promise<any>;\n\n  abstract close(): Promise<void>;\n}\n","import type { BaseModel } from \"./types\";\n\nexport default abstract class AbstractCursor<\n  Model extends BaseModel,\n  Result extends Partial<Model> = Model,\n> {\n  abstract close(): Promise<void> | void;\n\n  abstract next(): Promise<any>;\n\n  nextResult(): Promise<Result> {\n    return this.next().then(() => this.result());\n  }\n\n  abstract limit(newLimit: number): Promise<this>;\n\n  abstract toArray(): Promise<Result[]>;\n\n  abstract result(): Promise<Result>;\n\n  async forEachKeys(\n    callback: (key: any) => Promise<void> | void,\n  ): Promise<void> {\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    while (true) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const key = await this.next();\n      if (!key) return;\n\n      await callback(key);\n    }\n  }\n\n  forEach(callback: (result: Result) => Promise<void> | void): Promise<void> {\n    return this.forEachKeys(() =>\n      this.result().then((result) => callback(result)),\n    );\n  }\n\n  *keysIterator(): Generator<Promise<any>, void, undefined> {\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    while (true) {\n      yield this.next();\n    }\n  }\n\n  *[Symbol.iterator](): Generator<Promise<Result>, void, undefined> {\n    for (const keyPromise of this.keysIterator()) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      yield keyPromise.then((key) => key && this.result());\n    }\n  }\n\n  // TODO Symbol.asyncIterator, https://phabricator.babeljs.io/T7356\n  /*\n    async *keysAsyncIterator() {\n        while (true) {\n             const key = await this.next();\n             if (!key) return;\n\n             yield key;\n        }\n     }\n\n     async *[Symbol.asyncIterator] {\n        for await (let key of this.keysAsyncIterator()) {\n            yield await this.result();\n        }\n     }\n     */\n}\n","import AbstractCursor from \"./AbstractCursor\";\nimport type { InternalCommonStoreClient } from \"./InternalCommonStoreClient\";\nimport type { AllowedKeyValue, BaseModel } from \"./types\";\n\nexport default abstract class AbstractStoreCursor<\n  Store extends InternalCommonStoreClient<Model>,\n  KeyValue extends AllowedKeyValue,\n  Model extends BaseModel,\n  Result extends Partial<Model> = Model,\n> extends AbstractCursor<Model, Result> {\n  key: KeyValue | undefined;\n\n  protected _store: Store;\n\n  constructor(store: Store) {\n    super();\n    this._store = store;\n  }\n\n  get store(): Store {\n    return this._store;\n  }\n\n  overrideStore(store: Store): void {\n    this._store = store;\n  }\n\n  result(): Promise<Result> {\n    if (!this.key) throw new Error(\"Cannot call result() before next()\");\n    return this.store.findByKey(this.key) as unknown as Promise<Result>;\n  }\n\n  delete(): Promise<void> {\n    return this.store.deleteByKey(this.key);\n  }\n}\n"],"names":[],"mappings":"AAAA,MAA8B,kBAAA,CAAmB;AAIjD;;ACFA,MAA8B,cAAA,CAG5B;AAAA,EAKA,UAAA,GAA8B;AAC5B,IAAA,OAAO,KAAK,IAAA,EAAK,CAAE,KAAK,MAAM,IAAA,CAAK,QAAQ,CAAA;AAAA,EAC7C;AAAA,EAQA,MAAM,YACJ,QAAA,EACe;AAEf,IAAA,OAAO,IAAA,EAAM;AAEX,MAAA,MAAM,GAAA,GAAM,MAAM,IAAA,CAAK,IAAA,EAAK;AAC5B,MAAA,IAAI,CAAC,GAAA,EAAK;AAEV,MAAA,MAAM,SAAS,GAAG,CAAA;AAAA,IACpB;AAAA,EACF;AAAA,EAEA,QAAQ,QAAA,EAAmE;AACzE,IAAA,OAAO,IAAA,CAAK,WAAA;AAAA,MAAY,MACtB,KAAK,MAAA,EAAO,CAAE,KAAK,CAAC,MAAA,KAAW,QAAA,CAAS,MAAM,CAAC;AAAA,KACjD;AAAA,EACF;AAAA,EAEA,CAAC,YAAA,GAAyD;AAExD,IAAA,OAAO,IAAA,EAAM;AACX,MAAA,MAAM,KAAK,IAAA,EAAK;AAAA,IAClB;AAAA,EACF;AAAA,EAEA,EAAE,MAAA,CAAO,QAAQ,CAAA,GAAiD;AAChE,IAAA,KAAA,MAAW,UAAA,IAAc,IAAA,CAAK,YAAA,EAAa,EAAG;AAE5C,MAAA,MAAM,WAAW,IAAA,CAAK,CAAC,QAAQ,GAAA,IAAO,IAAA,CAAK,QAAQ,CAAA;AAAA,IACrD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmBF;;AClEA,MAA8B,4BAKpB,cAAA,CAA8B;AAAA,EAKtC,YAAY,KAAA,EAAc;AACxB,IAAA,KAAA,EAAM;AACN,IAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AAAA,EAChB;AAAA,EAEA,IAAI,KAAA,GAAe;AACjB,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA,EAEA,cAAc,KAAA,EAAoB;AAChC,IAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AAAA,EAChB;AAAA,EAEA,MAAA,GAA0B;AACxB,IAAA,IAAI,CAAC,IAAA,CAAK,GAAA,EAAK,MAAM,IAAI,MAAM,oCAAoC,CAAA;AACnE,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,SAAA,CAAU,IAAA,CAAK,GAAG,CAAA;AAAA,EACtC;AAAA,EAEA,MAAA,GAAwB;AACtB,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,WAAA,CAAY,IAAA,CAAK,GAAG,CAAA;AAAA,EACxC;AACF;;;;"}