{"version":3,"file":"index-browser.es.js","sources":["../src/AbstractConnection.js","../src/AbstractCursor.js","../src/AbstractQuery.js","../src/AbstractStore.js"],"sourcesContent":["export default class AbstractConnection {}\n","/* eslint-disable no-await-in-loop */\nimport type { ResultType } from './types';\n\nexport default class AbstractCursor<Store> {\n  key: any;\n\n  constructor(store: Store) {\n    this._store = store;\n  }\n\n  get store(): Store {\n    return this._store;\n  }\n\n  close() {\n    throw new Error('close() missing implementation');\n  }\n\n  next(): Promise<any> {\n    throw new Error('next() missing implementation');\n  }\n\n  nextResult(): Promise<any> {\n    return this.next().then(() => this.result());\n  }\n\n  limit(newLimit: number): Promise<void> {\n    throw new Error('limit() missing implementation');\n  }\n\n  count(applyLimit: boolean = false) {\n    throw new Error('count() missing implementation');\n  }\n\n  result(): Promise<ResultType> {\n    return this.store.findByKey(this.key);\n  }\n\n  delete(): Promise<void> {\n    return this.store.deleteByKey(this.key);\n  }\n\n  async forEachKeys(callback: Function): Promise<void> {\n    while (true) {\n      const key = await this.next();\n      if (!key) return;\n\n      await callback(key);\n    }\n  }\n\n  forEach(callback): Promise<void> {\n    return this.forEachKeys(() => this.result().then(result => callback(result)));\n  }\n\n  *keysIterator() {\n    while (true) {\n      yield this.next();\n    }\n  }\n\n  *[Symbol.iterator]() {\n    // eslint-disable-next-line no-restricted-syntax\n    for (const keyPromise of this.keysIterator()) {\n      yield keyPromise.then(key => key && this.result());\n    }\n  }\n\n  // TODO Symbol.asyncIterator, https://phabricator.babeljs.io/T7356\n  /*\n    async *keysAsyncIterator() {\n        while (true) {\n             const key = await this.next();\n             if (!key) return;\n\n             yield key;\n        }\n     }\n\n     async *[Symbol.asyncIterator] {\n        for await (let key of this.keysAsyncIterator()) {\n            yield await this.result();\n        }\n     }\n     */\n}\n","// eslint-disable-next-line no-unused-vars\nimport AbstractStore from './AbstractStore';\n\nexport default class AbstractQuery<Store: AbstractStore> {\n  store: Store;\n  queryCallback: ?Function;\n\n  constructor(store, queryCallback) {\n    this.store = store;\n    this.queryCallback = queryCallback;\n  }\n\n  fetchAndSubscribe(callback: Function, ...args) {\n    return this._subscribe(callback, true, args);\n  }\n\n  subscribe(callback: Function, ...args) {\n    return this._subscribe(callback, false, args);\n  }\n}\n","import assert from 'assert';\n\nexport default class AbstractStore<Connection> {\n  /**\n   * @param {AbstractConnection} connection\n   */\n  constructor(connection: Connection) {\n    assert(connection);\n    this._connection = connection;\n  }\n\n  get connection(): Connection {\n    return this._connection;\n  }\n\n  findAll(criteria: ?Object, sort: ?Object): Promise<Array<any>> {\n    return this.cursor(criteria, sort).then(cursor => cursor.toArray());\n  }\n}\n"],"names":["AbstractConnection","AbstractCursor","store","_store","Error","next","then","result","findByKey","key","deleteByKey","callback","forEachKeys","Symbol","iterator","keysIterator","keyPromise","AbstractQuery","queryCallback","args","_subscribe","AbstractStore","connection","_connection","criteria","sort","cursor","toArray"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAqBA;;;;ICGAC;0BAGPC,KAAZ,EAA0B;;;SACnBC,MAAL,GAAcD,KAAd;;;;;4BAOM;YACA,IAAIE,KAAJ,CAAU,gCAAV,CAAN;;;;2BAGmB;YACb,IAAIA,KAAJ,CAAU,+BAAV,CAAN;;;;iCAGyB;;;aAClB,KAAKC,IAAL,GAAYC,IAAZ,CAAiB;eAAM,MAAKC,MAAL,EAAN;OAAjB,CAAP;;;;4BAGqC;YAC/B,IAAIH,KAAJ,CAAU,gCAAV,CAAN;;;;4BAGiC;AAAA;YAC3B,IAAIA,KAAJ,CAAU,gCAAV,CAAN;;;;6BAG4B;aACrB,KAAKF,KAAL,CAAWM,SAAX,CAAqB,KAAKC,GAA1B,CAAP;;;;8BAGsB;aACf,KAAKP,KAAL,CAAWQ,WAAX,CAAuB,KAAKD,GAA5B,CAAP;;;;;yFAGgBE;;;;;;;uBAEI,KAAKN,IAAL;;;;;oBACbI;;;;;;;;;uBAECE,SAASF,GAAT;;;;;;;;;;;;;;;;;;;;4BAIFE,UAAyB;;;aACxB,KAAKC,WAAL,CAAiB;eAAM,OAAKL,MAAL,GAAcD,IAAd,CAAmB;iBAAUK,SAASJ,MAAT,CAAV;SAAnB,CAAN;OAAjB,CAAP;;;;;;;;;;qBAKQ,KAAKF,IAAL;;;;;;;;;;;;;;SAIRQ,OAAOC;;;;;;;;;;;;;;;0BAEkB,KAAKC,YAAL;;;;;;;;;;qBACjBC,WAAWV,IAAX,CAAgB;uBAAOG,OAAO,OAAKF,MAAL,EAAd;eAAhB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;2BAtDS;aACV,KAAKJ,MAAZ;;;;;;ICRiBc;yBAIPf,KAAZ,EAAmBgB,aAAnB,EAAkC;;;SAC3BhB,KAAL,GAAaA,KAAb;SACKgB,aAAL,GAAqBA,aAArB;;;;;sCAGgBP,UAA6B;wCAANQ,IAAM;YAAA;;;aACtC,KAAKC,UAAL,CAAgBT,QAAhB,EAA0B,IAA1B,EAAgCQ,IAAhC,CAAP;;;;8BAGQR,UAA6B;yCAANQ,IAAM;YAAA;;;aAC9B,KAAKC,UAAL,CAAgBT,QAAhB,EAA0B,KAA1B,EAAiCQ,IAAjC,CAAP;;;;;;ICfiBE;;;;yBAIPC,UAAZ,EAAoC;;;WAC3BA,UAAP;SACKC,WAAL,GAAmBD,UAAnB;;;;;4BAOME,UAAmBC,MAAoC;aACtD,KAAKC,MAAL,CAAYF,QAAZ,EAAsBC,IAAtB,EAA4BnB,IAA5B,CAAiC;eAAUoB,OAAOC,OAAP,EAAV;OAAjC,CAAP;;;;2BAL2B;aACpB,KAAKJ,WAAZ;;;;;;;;"}