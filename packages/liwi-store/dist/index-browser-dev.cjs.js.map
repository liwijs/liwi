{"version":3,"file":"index-browser-dev.cjs.js","sources":["../src/AbstractConnection.js","../src/types.js","../src/AbstractCursor.js","../src/AbstractStore.js","../src/AbstractQuery.js"],"sourcesContent":["export default class AbstractConnection {}\n","export type InsertType = {};\nexport type UpdateType = {};\nexport type ResultType = {\n  created: Date | Object, // created can be specified\n};\n\nexport type CursorInterfaceType = {\n  // store: StoreInterface,\n\n  close(): Promise<void> | void,\n\n  next(): Promise<any>,\n\n  nextResult(): Promise<any>,\n\n  limit(newLimit: number): Promise<void>,\n\n  count(applyLimit: ?boolean): Promise<number>,\n\n  result(): Promise<ResultType>,\n\n  delete(): Promise<void>,\n\n  forEachKeys(callback: Function): Promise<void>,\n\n  forEach(callback: Function): Promise<void>,\n};\n\nexport type StoreInterfaceType = {\n  create(): Promise<void>,\n\n  insertOne(object: InsertType): Promise<ResultType>,\n\n  replaceOne(object: InsertType): Promise<ResultType>,\n\n  upsertOne(object: InsertType): Promise<ResultType>,\n\n  updateSeveral(objects: Array<UpdateType>): Promise<Array<ResultType>>,\n\n  partialUpdateByKey(key: any, partialUpdate: UpdateType): Promise<ResultType>,\n\n  partialUpdateOne(object: ResultType, partialUpdate: UpdateType): Promise<ResultType>,\n\n  partialUpdateMany(criteria: Object, partialUpdate: UpdateType): Promise<void>,\n\n  deleteByKey(key: any): Promise<void>,\n\n  cursor(criteria: ?Object, sort: ?Object): Promise<CursorInterfaceType<ResultType>>,\n\n  findAll(criteria: ?Object, sort: ?Object): Promise<Array<ResultType>>,\n\n  findByKey(key: any): Promise<?ResultType>,\n\n  findOne(criteria: Object, sort: ?Object): Promise<?ResultType>,\n};\n","/* eslint-disable no-await-in-loop */\nimport type { ResultType } from './types';\n\nexport default class AbstractCursor<Store> {\n  key: any;\n\n  constructor(store: Store) {\n    this._store = store;\n  }\n\n  get store(): Store {\n    return this._store;\n  }\n\n  close() {\n    throw new Error('close() missing implementation');\n  }\n\n  next(): Promise<any> {\n    throw new Error('next() missing implementation');\n  }\n\n  nextResult(): Promise<any> {\n    return this.next().then(() => this.result());\n  }\n\n  limit(newLimit: number): Promise<void> {\n    throw new Error('limit() missing implementation');\n  }\n\n  count(applyLimit: boolean = false) {\n    throw new Error('count() missing implementation');\n  }\n\n  result(): Promise<ResultType> {\n    return this.store.findByKey(this.key);\n  }\n\n  delete(): Promise<void> {\n    return this.store.deleteByKey(this.key);\n  }\n\n  async forEachKeys(callback: Function): Promise<void> {\n    while (true) {\n      const key = await this.next();\n      if (!key) return;\n\n      await callback(key);\n    }\n  }\n\n  forEach(callback): Promise<void> {\n    return this.forEachKeys(() => this.result().then(result => callback(result)));\n  }\n\n  *keysIterator() {\n    while (true) {\n      yield this.next();\n    }\n  }\n\n  *[Symbol.iterator]() {\n    // eslint-disable-next-line no-restricted-syntax\n    for (const keyPromise of this.keysIterator()) {\n      yield keyPromise.then(key => key && this.result());\n    }\n  }\n\n  // TODO Symbol.asyncIterator, https://phabricator.babeljs.io/T7356\n  /*\n    async *keysAsyncIterator() {\n        while (true) {\n             const key = await this.next();\n             if (!key) return;\n\n             yield key;\n        }\n     }\n\n     async *[Symbol.asyncIterator] {\n        for await (let key of this.keysAsyncIterator()) {\n            yield await this.result();\n        }\n     }\n     */\n}\n","import assert from 'assert';\n\nexport default class AbstractStore<Connection> {\n  /**\n   * @param {AbstractConnection} connection\n   */\n  constructor(connection: Connection) {\n    assert(connection);\n    this._connection = connection;\n  }\n\n  get connection(): Connection {\n    return this._connection;\n  }\n\n  findAll(criteria: ?Object, sort: ?Object): Promise<Array<any>> {\n    return this.cursor(criteria, sort).then(cursor => cursor.toArray());\n  }\n}\n","// eslint-disable-next-line no-unused-vars\nimport AbstractStore from './AbstractStore';\n\nexport default class AbstractQuery<Store: AbstractStore> {\n  store: Store;\n  queryCallback: ?Function;\n\n  constructor(store, queryCallback) {\n    this.store = store;\n    this.queryCallback = queryCallback;\n  }\n\n  fetchAndSubscribe(callback: Function, ...args) {\n    return this._subscribe(callback, true, args);\n  }\n\n  subscribe(callback: Function, ...args) {\n    return this._subscribe(callback, false, args);\n  }\n}\n"],"names":["AbstractConnection","AbstractCursor","store","_store","Error","next","then","result","newLimit","applyLimit","findByKey","key","deleteByKey","callback","forEachKeys","Symbol","iterator","keysIterator","keyPromise","AbstractStore","connection","_connection","criteria","sort","cursor","toArray","AbstractQuery","queryCallback","args","_subscribe"],"mappings":"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"}