{"version":3,"file":"index-browser.cjs.js","sources":["../src/AbstractConnection.ts","../src/AbstractCursor.ts","../src/AbstractStoreCursor.ts"],"sourcesContent":["export default abstract class AbstractConnection {\n  abstract getConnection(): Promise<any>;\n\n  abstract close(): Promise<void>;\n}\n","import type { BaseModel } from 'liwi-types';\n\nexport default abstract class AbstractCursor<\n  Model extends BaseModel,\n  Result extends Partial<Model> = Model,\n> {\n  abstract close(): Promise<void> | void;\n\n  abstract next(): Promise<any>;\n\n  nextResult(): Promise<Result> {\n    return this.next().then(() => this.result());\n  }\n\n  abstract limit(newLimit: number): Promise<this>;\n\n  abstract toArray(): Promise<Result[]>;\n\n  abstract result(): Promise<Result>;\n\n  async forEachKeys(\n    callback: (key: any) => Promise<void> | void,\n  ): Promise<void> {\n    while (true) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const key = await this.next();\n      if (!key) return;\n\n      await callback(key);\n    }\n  }\n\n  forEach(callback: (result: Result) => Promise<void> | void): Promise<void> {\n    return this.forEachKeys(() =>\n      this.result().then((result) => callback(result)),\n    );\n  }\n\n  *keysIterator(): Generator<Promise<any>, void, undefined> {\n    while (true) {\n      yield this.next();\n    }\n  }\n\n  *[Symbol.iterator](): Generator<Promise<Result>, void, undefined> {\n    for (const keyPromise of this.keysIterator()) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      yield keyPromise.then((key) => key && this.result());\n    }\n  }\n\n  // TODO Symbol.asyncIterator, https://phabricator.babeljs.io/T7356\n  /*\n    async *keysAsyncIterator() {\n        while (true) {\n             const key = await this.next();\n             if (!key) return;\n\n             yield key;\n        }\n     }\n\n     async *[Symbol.asyncIterator] {\n        for await (let key of this.keysAsyncIterator()) {\n            yield await this.result();\n        }\n     }\n     */\n}\n","import type { BaseModel, AllowedKeyValue } from 'liwi-types';\nimport AbstractCursor from './AbstractCursor';\nimport type { InternalCommonStoreClient } from './InternalCommonStoreClient';\n\nexport default abstract class AbstractStoreCursor<\n  Store extends InternalCommonStoreClient<Model>,\n  KeyValue extends AllowedKeyValue,\n  Model extends BaseModel,\n  Result extends Partial<Model> = Model,\n> extends AbstractCursor<Model, Result> {\n  key: KeyValue | undefined;\n\n  protected _store: Store;\n\n  constructor(store: Store) {\n    super();\n    this._store = store;\n  }\n\n  get store(): Store {\n    return this._store;\n  }\n\n  overrideStore(store: Store): void {\n    this._store = store;\n  }\n\n  result(): Promise<Result> {\n    if (!this.key) throw new Error('Cannot call result() before next()');\n    return this.store.findByKey(this.key) as unknown as Promise<Result>;\n  }\n\n  delete(): Promise<void> {\n    return this.store.deleteByKey(this.key);\n  }\n}\n"],"names":["AbstractConnection","AbstractCursor","nextResult","next","then","result","forEachKeys","callback","key","forEach","keysIterator","keyPromise","Symbol","iterator","AbstractStoreCursor","store","_store","overrideStore","Error","findByKey","deleteByKey"],"mappings":";;;;;;;;;;;;;;;;IAA8BA;;;;;;;;ICEAC;;;;;SAQ5BC,aAAA,sBAA8B;AAAA;;AAC5B,WAAO,KAAKC,IAAL,GAAYC,IAAZ,CAAiB;AAAA,aAAM,KAAI,CAACC,MAAL,EAAN;AAAA,KAAjB,CAAP;AACD;;SAQKC;kGAAN,iBACEC,QADF;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAKsB,KAAKJ,IAAL,EALtB;;AAAA;AAKUK,cAAAA,IALV;;AAAA,kBAMSA,IANT;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,qBAQUD,QAAQ,CAACC,IAAD,CARlB;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;SAYAC,UAAA,iBAAQF,QAAR,EAA2E;AAAA;;AACzE,WAAO,KAAKD,WAAL,CAAiB;AAAA,aACtB,MAAI,CAACD,MAAL,GAAcD,IAAd,CAAmB,UAACC,MAAD;AAAA,eAAYE,QAAQ,CAACF,MAAD,CAApB;AAAA,OAAnB,CADsB;AAAA,KAAjB,CAAP;AAGD;;SAEAK,8DAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAEI,mBAAM,KAAKP,IAAL,EAAN;;AAFJ;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;4EAMA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,wDAC2B,KAAKO,YAAL,EAD3B;;AAAA;AAAA;AAAA;AAAA;AAAA;;AACaC,YAAAA,UADb;AAAA;AAGI,mBAAMA,UAAU,CAACP,IAAX,CAAgB,UAACI,GAAD;AAAA,qBAASA,GAAG,IAAI,MAAI,CAACH,MAAL,EAAhB;AAAA,aAAhB,CAAN;;AAHJ;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;EArBIO,MAAM,CAACC;;ICxCmBC;;;AAU5B,+BAAYC,KAAZ,EAA0B;AAAA,gBACxB,0BADwB;;AAExB,UAAKC,MAAL,GAAcD,KAAd;AAFwB;AAGzB;;;;SAMDE,gBAAA,uBAAcF,KAAd,EAAkC;AAChC,SAAKC,MAAL,GAAcD,KAAd;AACD;;SAEDV,SAAA,kBAA0B;AACxB,QAAI,CAAC,KAAKG,GAAV,EAAe,MAAM,IAAIU,KAAJ,CAAU,oCAAV,CAAN;AACf,WAAO,KAAKH,KAAL,CAAWI,SAAX,CAAqB,KAAKX,GAA1B,CAAP;AACD;;qBAED,mBAAwB;AACtB,WAAO,KAAKO,KAAL,CAAWK,WAAX,CAAuB,KAAKZ,GAA5B,CAAP;AACD;;;;SAfD,eAAmB;AACjB,aAAO,KAAKQ,MAAZ;AACD;;;;EAZOf;;;;;;"}