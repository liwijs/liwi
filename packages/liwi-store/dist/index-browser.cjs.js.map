{"version":3,"file":"index-browser.cjs.js","sources":["../src/AbstractConnection.ts","../src/AbstractCursor.ts","../src/AbstractStoreCursor.ts"],"sourcesContent":["export default abstract class AbstractConnection {\n  abstract getConnection(): Promise<any>;\n\n  abstract close(): Promise<void>;\n}\n","import type { BaseModel } from 'liwi-types';\n\nexport default abstract class AbstractCursor<\n  Model extends BaseModel,\n  Result extends Partial<Model> = Model,\n> {\n  abstract close(): Promise<void> | void;\n\n  abstract next(): Promise<any>;\n\n  nextResult(): Promise<Result> {\n    return this.next().then(() => this.result());\n  }\n\n  abstract limit(newLimit: number): Promise<this>;\n\n  abstract toArray(): Promise<Result[]>;\n\n  abstract result(): Promise<Result>;\n\n  async forEachKeys(\n    callback: (key: any) => Promise<void> | void,\n  ): Promise<void> {\n    while (true) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const key = await this.next();\n      if (!key) return;\n\n      await callback(key);\n    }\n  }\n\n  forEach(callback: (result: Result) => Promise<void> | void): Promise<void> {\n    return this.forEachKeys(() =>\n      this.result().then((result) => callback(result)),\n    );\n  }\n\n  *keysIterator(): Generator<Promise<any>, void, undefined> {\n    while (true) {\n      yield this.next();\n    }\n  }\n\n  *[Symbol.iterator](): Generator<Promise<Result>, void, undefined> {\n    for (const keyPromise of this.keysIterator()) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n      yield keyPromise.then((key) => key && this.result());\n    }\n  }\n\n  // TODO Symbol.asyncIterator, https://phabricator.babeljs.io/T7356\n  /*\n    async *keysAsyncIterator() {\n        while (true) {\n             const key = await this.next();\n             if (!key) return;\n\n             yield key;\n        }\n     }\n\n     async *[Symbol.asyncIterator] {\n        for await (let key of this.keysAsyncIterator()) {\n            yield await this.result();\n        }\n     }\n     */\n}\n","import type { BaseModel, AllowedKeyValue } from 'liwi-types';\nimport AbstractCursor from './AbstractCursor';\nimport type { InternalCommonStoreClient } from './InternalCommonStoreClient';\n\nexport default abstract class AbstractStoreCursor<\n  Store extends InternalCommonStoreClient<Model>,\n  KeyValue extends AllowedKeyValue,\n  Model extends BaseModel,\n  Result extends Partial<Model> = Model,\n> extends AbstractCursor<Model, Result> {\n  key: KeyValue | undefined;\n\n  protected _store: Store;\n\n  constructor(store: Store) {\n    super();\n    this._store = store;\n  }\n\n  get store(): Store {\n    return this._store;\n  }\n\n  overrideStore(store: Store): void {\n    this._store = store;\n  }\n\n  result(): Promise<Result> {\n    if (!this.key) throw new Error('Cannot call result() before next()');\n    return this.store.findByKey(this.key) as unknown as Promise<Result>;\n  }\n\n  delete(): Promise<void> {\n    return this.store.deleteByKey(this.key);\n  }\n}\n"],"names":["AbstractConnection","AbstractCursor","nextResult","next","then","result","forEachKeys","_asyncToGenerator","_regeneratorRuntime","callback","key","forEach","keysIterator","_createForOfIteratorHelperLoose","keyPromise","Symbol","iterator","AbstractStoreCursor","store","_store","overrideStore","Error","findByKey","deleteByKey"],"mappings":";;;;;;;;;;;;;;;;;;IAA8BA;;ICEAC;;;;;AAQ5BC,EAAAA,MAAAA,CAAAA,aAAA,SAA8B,UAAA,GAAA;AAC5B,IAAA,OAAO,IAAKC,CAAAA,IAAL,EAAYC,CAAAA,IAAZ,CAAiB,YAAA;MAAA,OAAM,IAAA,CAAKC,MAAL,EAAN,CAAA;AAAA,KAAjB,CAAP,CAAA;;;SASIC;AAAN,IAAA,IAAA,YAAA,GAAAC,0BAAA,eAAAC,4BAAA,EAAA,CAAA,IAAA,CAAA,SAAA,OAAA,CACEC,QADF,EAAA;AAAA,MAAA,IAAA,IAAA,CAAA;;AAAA,MAAA,OAAAD,4BAAA,EAAA,CAAA,IAAA,CAAA,SAAA,QAAA,CAAA,QAAA,EAAA;AAAA,QAAA,OAAA,CAAA,EAAA;AAAA,UAAA,QAAA,QAAA,CAAA,IAAA,GAAA,QAAA,CAAA,IAAA;AAAA,YAAA,KAAA,CAAA;AAAA,cAAA,QAAA,CAAA,IAAA,GAAA,CAAA,CAAA;cAAA,OAKsB,IAAA,CAAKL,IAAL,EALtB,CAAA;;AAAA,YAAA,KAAA,CAAA;cAKUO,IALV,GAAA,QAAA,CAAA,IAAA,CAAA;;AAAA,cAAA,IAMSA,IANT,EAAA;AAAA,gBAAA,QAAA,CAAA,IAAA,GAAA,CAAA,CAAA;AAAA,gBAAA,MAAA;AAAA,eAAA;;AAAA,cAAA,OAAA,QAAA,CAAA,MAAA,CAAA,QAAA,CAAA,CAAA;;AAAA,YAAA,KAAA,CAAA;AAAA,cAAA,QAAA,CAAA,IAAA,GAAA,CAAA,CAAA;cAAA,OAQUD,QAAQ,CAACC,IAAD,CARlB,CAAA;;AAAA,YAAA,KAAA,CAAA;AAAA,cAAA,QAAA,CAAA,IAAA,GAAA,CAAA,CAAA;AAAA,cAAA,MAAA;;AAAA,YAAA,KAAA,EAAA,CAAA;AAAA,YAAA,KAAA,KAAA;AAAA,cAAA,OAAA,QAAA,CAAA,IAAA,EAAA,CAAA;AAAA,WAAA;AAAA,SAAA;AAAA,OAAA,EAAA,OAAA,EAAA,IAAA,CAAA,CAAA;;;;;;;;SAYAC,UAAA,SAAQF,OAAAA,CAAAA,QAAR,EAA2E;IACzE,OAAO,IAAA,CAAKH,WAAL,CAAiB,YAAA;AAAA,MAAA,OACtB,KAAKD,MAAL,EAAA,CAAcD,IAAd,CAAmB,UAACC,MAAD,EAAA;QAAA,OAAYI,QAAQ,CAACJ,MAAD,CAApB,CAAA;AAAA,OAAnB,CADsB,CAAA;AAAA,KAAjB,CAAP,CAAA;;;AAKDO,EAAAA,MAAAA,CAAAA,4BAADJ,4BAAA,EAAA,CAAA,IAAA,CAAA,SAAA,YAAA,GAAA;AAAA,IAAA,OAAAA,4BAAA,EAAA,CAAA,IAAA,CAAA,SAAA,aAAA,CAAA,SAAA,EAAA;AAAA,MAAA,OAAA,CAAA,EAAA;AAAA,QAAA,QAAA,SAAA,CAAA,IAAA,GAAA,SAAA,CAAA,IAAA;AAAA,UAAA,KAAA,CAAA;AAAA,YAAA,SAAA,CAAA,IAAA,GAAA,CAAA,CAAA;YAEI,OAAM,IAAA,CAAKL,IAAL,EAAN,CAAA;;AAFJ,UAAA,KAAA,CAAA;AAAA,YAAA,SAAA,CAAA,IAAA,GAAA,CAAA,CAAA;AAAA,YAAA,MAAA;;AAAA,UAAA,KAAA,CAAA,CAAA;AAAA,UAAA,KAAA,KAAA;AAAA,YAAA,OAAA,SAAA,CAAA,IAAA,EAAA,CAAA;AAAA,SAAA;AAAA,OAAA;AAAA,KAAA,EAAA,YAAA,EAAA,IAAA,CAAA,CAAA;;AAMA,EAAA,MAAA,CAAA,gBAAA,CAAA,gBAAAK,4BAAA,EAAA,CAAA,IAAA,CAAA,SAAA,QAAA,GAAA;AAAA,IAAA,IAAA,SAAA,EAAA,KAAA,EAAA,UAAA,CAAA;;AAAA,IAAA,OAAAA,4BAAA,EAAA,CAAA,IAAA,CAAA,SAAA,SAAA,CAAA,SAAA,EAAA;AAAA,MAAA,OAAA,CAAA,EAAA;AAAA,QAAA,QAAA,SAAA,CAAA,IAAA,GAAA,SAAA,CAAA,IAAA;AAAA,UAAA,KAAA,CAAA;YAAA,SAC2B,GAAAK,wCAAA,CAAA,IAAA,CAAKD,YAAL,EAD3B,CAAA,CAAA;;AAAA,UAAA,KAAA,CAAA;AAAA,YAAA,IAAA,CAAA,KAAA,GAAA,SAAA,EAAA,EAAA,IAAA,EAAA;AAAA,cAAA,SAAA,CAAA,IAAA,GAAA,CAAA,CAAA;AAAA,cAAA,MAAA;AAAA,aAAA;;YACaE,UADb,GAAA,KAAA,CAAA,KAAA,CAAA;AAAA,YAAA,SAAA,CAAA,IAAA,GAAA,CAAA,CAAA;AAGI,YAAA,OAAMA,UAAU,CAACV,IAAX,CAAgB,UAACM,GAAD,EAAA;AAAA,cAAA,OAASA,GAAG,IAAI,IAAKL,CAAAA,MAAL,EAAhB,CAAA;AAAA,aAAhB,CAAN,CAAA;;AAHJ,UAAA,KAAA,CAAA;AAAA,YAAA,SAAA,CAAA,IAAA,GAAA,CAAA,CAAA;AAAA,YAAA,MAAA;;AAAA,UAAA,KAAA,CAAA,CAAA;AAAA,UAAA,KAAA,KAAA;AAAA,YAAA,OAAA,SAAA,CAAA,IAAA,EAAA,CAAA;AAAA,SAAA;AAAA,OAAA;AAAA,KAAA,EAAA,QAAA,EAAA,IAAA,CAAA,CAAA;AAAA,IAOA;;AACA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AArBIU,CAAAA,CAAAA,MAAM,CAACC;;ICxCmBC;;;AAU5B,EAAA,SAAA,mBAAA,CAAYC,KAAZ,EAA0B;AAAA,IAAA,IAAA,KAAA,GACxB,eADwB,CAAA,IAAA,CAAA,IAAA,CAAA,IAAA,IAAA,CAAA;;IAExB,KAAKC,CAAAA,MAAL,GAAcD,KAAd,CAAA;AAFwB,IAAA,OAAA,KAAA,CAAA;AAGzB,GAAA;;;;SAMDE,gBAAA,SAAcF,aAAAA,CAAAA,KAAd,EAAkC;IAChC,IAAKC,CAAAA,MAAL,GAAcD,KAAd,CAAA;;;AAGFb,EAAAA,MAAAA,CAAAA,SAAA,SAA0B,MAAA,GAAA;IACxB,IAAI,CAAC,KAAKK,GAAV,EAAe,MAAM,IAAIW,KAAJ,CAAU,oCAAV,CAAN,CAAA;AACf,IAAA,OAAO,KAAKH,KAAL,CAAWI,SAAX,CAAqB,IAAA,CAAKZ,GAA1B,CAAP,CAAA;;;qBAGF,SAAwB,OAAA,GAAA;AACtB,IAAA,OAAO,KAAKQ,KAAL,CAAWK,WAAX,CAAuB,IAAA,CAAKb,GAA5B,CAAP,CAAA;;;;;SAdF,SAAmB,GAAA,GAAA;AACjB,MAAA,OAAO,KAAKS,MAAZ,CAAA;AACD,KAAA;;;;EAZOlB;;;;;;"}