{"version":3,"file":"index-node8.cjs.js","sources":["../src/AbstractConnection.js","../src/AbstractCursor.js","../src/AbstractQuery.js","../src/AbstractStore.js"],"sourcesContent":["export default class AbstractConnection {}\n","/* eslint-disable no-await-in-loop */\nimport type { ResultType } from './types';\n\nexport default class AbstractCursor<Store> {\n  key: any;\n\n  constructor(store: Store) {\n    this._store = store;\n  }\n\n  get store(): Store {\n    return this._store;\n  }\n\n  close() {\n    throw new Error('close() missing implementation');\n  }\n\n  next(): Promise<any> {\n    throw new Error('next() missing implementation');\n  }\n\n  nextResult(): Promise<any> {\n    return this.next().then(() => this.result());\n  }\n\n  limit(newLimit: number): Promise<void> {\n    throw new Error('limit() missing implementation');\n  }\n\n  count(applyLimit: boolean = false) {\n    throw new Error('count() missing implementation');\n  }\n\n  result(): Promise<ResultType> {\n    return this.store.findByKey(this.key);\n  }\n\n  delete(): Promise<void> {\n    return this.store.deleteByKey(this.key);\n  }\n\n  async forEachKeys(callback: Function): Promise<void> {\n    while (true) {\n      const key = await this.next();\n      if (!key) return;\n\n      await callback(key);\n    }\n  }\n\n  forEach(callback): Promise<void> {\n    return this.forEachKeys(() => this.result().then(result => callback(result)));\n  }\n\n  *keysIterator() {\n    while (true) {\n      yield this.next();\n    }\n  }\n\n  *[Symbol.iterator]() {\n    // eslint-disable-next-line no-restricted-syntax\n    for (const keyPromise of this.keysIterator()) {\n      yield keyPromise.then(key => key && this.result());\n    }\n  }\n\n  // TODO Symbol.asyncIterator, https://phabricator.babeljs.io/T7356\n  /*\n    async *keysAsyncIterator() {\n        while (true) {\n             const key = await this.next();\n             if (!key) return;\n\n             yield key;\n        }\n     }\n\n     async *[Symbol.asyncIterator] {\n        for await (let key of this.keysAsyncIterator()) {\n            yield await this.result();\n        }\n     }\n     */\n}\n","// eslint-disable-next-line no-unused-vars\nimport AbstractStore from './AbstractStore';\n\nexport default class AbstractQuery<Store: AbstractStore> {\n  store: Store;\n  queryCallback: ?Function;\n\n  constructor(store, queryCallback) {\n    this.store = store;\n    this.queryCallback = queryCallback;\n  }\n\n  fetchAndSubscribe(callback: Function, ...args) {\n    return this._subscribe(callback, true, args);\n  }\n\n  subscribe(callback: Function, ...args) {\n    return this._subscribe(callback, false, args);\n  }\n}\n","import assert from 'assert';\n\nexport default class AbstractStore<Connection> {\n  /**\n   * @param {AbstractConnection} connection\n   */\n  constructor(connection: Connection) {\n    assert(connection);\n    this._connection = connection;\n  }\n\n  get connection(): Connection {\n    return this._connection;\n  }\n\n  findAll(criteria: ?Object, sort: ?Object): Promise<Array<any>> {\n    return this.cursor(criteria, sort).then(cursor => cursor.toArray());\n  }\n}\n"],"names":["AbstractConnection","AbstractCursor","store","_store","Error","next","then","result","applyLimit","findByKey","key","deleteByKey","forEachKeys","callback","keysIterator","Symbol","iterator","keyPromise","AbstractQuery","queryCallback","args","_subscribe","AbstractStore","connection","_connection","criteria","sort","cursor","toArray"],"mappings":";;;;;;;;IAAqBA,qBAAN,MAAyB;;ICGnBC,iBAAN,MAA4B;;cAG7BC,KAAZ,EAA0B;SACnBC,MAAL,GAAcD,KAAd;;;MAGEA,KAAJ,GAAmB;WACV,KAAKC,MAAZ;;;UAGM;UACA,IAAIC,KAAJ,CAAU,gCAAV,CAAN;;;SAGmB;UACb,IAAIA,KAAJ,CAAU,+BAAV,CAAN;;;eAGyB;WAClB,KAAKC,IAAL,GAAYC,IAAZ,CAAiB,MAAM,KAAKC,MAAL,EAAvB,CAAP;;;UAGqC;UAC/B,IAAIH,KAAJ,CAAU,gCAAV,CAAN;;;QAGII,aAAsB,KAA5B,EAAmC;UAC3B,IAAIJ,KAAJ,CAAU,gCAAV,CAAN;;;WAG4B;WACrB,KAAKF,KAAL,CAAWO,SAAX,CAAqB,KAAKC,GAA1B,CAAP;;;WAGsB;WACf,KAAKR,KAAL,CAAWS,WAAX,CAAuB,KAAKD,GAA5B,CAAP;;;QAGIE,WAAN,CAAkBC,QAAlB,EAAqD;WAC5C,IAAP,EAAa;YACLH,MAAM,MAAM,KAAKL,IAAL,EAAlB;UACI,CAACK,GAAL,EAAU;;YAEJG,SAASH,GAAT,CAAN;;;;UAIIG,QAAR,EAAiC;WACxB,KAAKD,WAAL,CAAiB,MAAM,KAAKL,MAAL,GAAcD,IAAd,CAAmBC,UAAUM,SAASN,MAAT,CAA7B,CAAvB,CAAP;;;GAGDO,YAAD,GAAgB;WACP,IAAP,EAAa;YACL,KAAKT,IAAL,EAAN;;;;IAIFU,OAAOC,QAAT,IAAqB;;SAEd,MAAMC,UAAX,IAAyB,KAAKH,YAAL,EAAzB,EAA8C;YACtCG,WAAWX,IAAX,CAAgBI,OAAOA,OAAO,KAAKH,MAAL,EAA9B,CAAN;;;;;;;;;;;;;;;;;;;;;IC7DeW,gBAAN,MAA0C;;cAI3ChB,KAAZ,EAAmBiB,aAAnB,EAAkC;SAC3BjB,KAAL,GAAaA,KAAb;SACKiB,aAAL,GAAqBA,aAArB;;;oBAGgBN,QAAlB,EAAsC,GAAGO,IAAzC,EAA+C;WACtC,KAAKC,UAAL,CAAgBR,QAAhB,EAA0B,IAA1B,EAAgCO,IAAhC,CAAP;;;YAGQP,QAAV,EAA8B,GAAGO,IAAjC,EAAuC;WAC9B,KAAKC,UAAL,CAAgBR,QAAhB,EAA0B,KAA1B,EAAiCO,IAAjC,CAAP;;;;ICfiBE,gBAAN,MAAgC;;;;cAIjCC,UAAZ,EAAoC;WAC3BA,UAAP;SACKC,WAAL,GAAmBD,UAAnB;;;MAGEA,UAAJ,GAA6B;WACpB,KAAKC,WAAZ;;;UAGMC,QAAR,EAA2BC,IAA3B,EAA+D;WACtD,KAAKC,MAAL,CAAYF,QAAZ,EAAsBC,IAAtB,EAA4BpB,IAA5B,CAAiCqB,UAAUA,OAAOC,OAAP,EAA3C,CAAP;;;;;;;;;"}