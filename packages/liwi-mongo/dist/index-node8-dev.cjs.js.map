{"version":3,"file":"index-node8-dev.cjs.js","sources":["../src/MongoConnection.js","../src/MongoCursor.js","../src/MongoStore.js"],"sourcesContent":["import Logger from 'nightingale-logger';\nimport { MongoClient } from 'mongodb';\nimport Db from 'mongodb/lib/db';\nimport { AbstractConnection } from 'liwi-store';\n\nconst logger = new Logger('liwi:mongo:MongoConnection');\n\nexport default class MongoConnection extends AbstractConnection {\n  _connection: Db | null;\n  _connecting: Promise<void> | null;\n  connectionFailed: boolean;\n\n  constructor(config: Map<string, string | number>) {\n    super();\n\n    if (!config.has('host')) {\n      config.set('host', 'localhost');\n    }\n    if (!config.has('port')) {\n      config.set('port', '27017');\n    }\n    if (!config.has('database')) {\n      throw new Error('Missing config database');\n    }\n\n    const connectionString =\n      `mongodb://${config.has('user') ? `${config.get('user')}:${config.get('password')}@` : ''}` +\n      `${config.get('host')}:${config.get('port')}/${config.get('database')}`;\n\n    this.connect(connectionString);\n  }\n\n  connect(connectionString) {\n    logger.info('connecting', { connectionString });\n\n    const connectPromise = MongoClient.connect(connectionString)\n      .then(connection => {\n        logger.info('connected', { connectionString });\n        connection.on('close', () => {\n          logger.warn('close', { connectionString });\n          this.connectionFailed = true;\n          this.getConnection = () => Promise.reject(new Error('MongoDB connection closed'));\n        });\n        connection.on('timeout', () => {\n          logger.warn('timeout', { connectionString });\n          this.connectionFailed = true;\n          this.getConnection = () => Promise.reject(new Error('MongoDB connection timeout'));\n        });\n        connection.on('reconnect', () => {\n          logger.warn('reconnect', { connectionString });\n          this.connectionFailed = false;\n          this.getConnection = () => Promise.resolve(this._connection);\n        });\n        connection.on('error', err => {\n          logger.warn('error', { connectionString, err });\n        });\n\n        this._connection = connection;\n        this._connecting = null;\n        this.getConnection = () => Promise.resolve(this._connection);\n        return connection;\n      })\n      .catch(err => {\n        logger.info('not connected', { connectionString });\n        console.error(err.message || err);\n        // throw err;\n        process.nextTick(() => {\n          process.exit(1);\n        });\n\n        throw err;\n      });\n\n    this.getConnection = () => Promise.resolve(connectPromise);\n    this._connecting = this.getConnection();\n  }\n\n  getConnection(): Promise<Db> {\n    throw new Error('call connect()');\n  }\n\n  close() {\n    this.getConnection = () => Promise.reject(new Error('Connection closed'));\n    if (this._connection) {\n      return this._connection.close().then(() => {\n        this._connection = null;\n      });\n    } else if (this._connecting) {\n      return this._connecting.then(() => this.close());\n    }\n  }\n}\n","import Cursor from 'mongodb/lib/cursor';\nimport { AbstractCursor, type ResultType } from 'liwi-store';\nimport MongoStore from './MongoStore';\n\nexport default class MongoCursor extends AbstractCursor<MongoStore> {\n  constructor(store: MongoStore, cursor: Cursor) {\n    super(store);\n    this._cursor = cursor;\n  }\n\n  advance(count: number): void {\n    this._cursor.skip(count);\n  }\n\n  next(): Promise<any> {\n    return this._cursor.next().then(value => {\n      this._result = value;\n      this.key = value && value._id;\n      return this.key;\n    });\n  }\n\n  limit(newLimit: number): Promise {\n    this._cursor.limit(newLimit);\n    return Promise.resolve(this);\n  }\n\n  count(applyLimit: boolean = false) {\n    return this._cursor.count(applyLimit);\n  }\n\n  result() {\n    return Promise.resolve(this._result);\n  }\n\n  close() {\n    if (this._cursor) {\n      this._cursor.close();\n      this._cursor = undefined;\n      this._store = undefined;\n      this._result = undefined;\n    }\n\n    return Promise.resolve();\n  }\n\n  toArray(): Promise<Array<ResultType>> {\n    return this._cursor.toArray();\n  }\n}\n","import { ObjectID } from 'mongodb';\nimport Collection from 'mongodb/lib/collection';\nimport Db from 'mongodb/lib/db';\nimport { AbstractStore, type InsertType, type UpdateType, type ResultType } from 'liwi-store';\nimport MongoConnection from './MongoConnection';\nimport MongoCursor from './MongoCursor';\n\ntype MongoUpdateCommandResultType = {\n  connection: any,\n  matchedCount: number,\n  modifiedCount: number,\n  result: {| n: number, nModified: number, ok: number |},\n  upsertedCount: number,\n  upsertedId: null,\n};\n\nexport default class MongoStore extends AbstractStore<MongoConnection> {\n  _collection: Collection | Promise<Collection>;\n  keyPath = '_id';\n\n  constructor(connection: MongoConnection, collectionName: string) {\n    super(connection);\n\n    if (!collectionName) {\n      throw new Error(`Invalid collectionName: \"${collectionName}\"`);\n    }\n\n    this._collection = connection.getConnection().then(\n      (db: Db) => {\n        this._collection = db.collection(collectionName);\n        return this._collection;\n      },\n      (err: any) => {\n        this._collection = Promise.reject(err);\n        return this._collection;\n      },\n    );\n  }\n\n  get collection(): Promise<Collection> {\n    if (this.connection.connectionFailed) {\n      return Promise.reject(new Error('MongoDB connection failed'));\n    }\n\n    return Promise.resolve(this._collection);\n  }\n\n  create(): Promise {\n    return Promise.resolve();\n  }\n\n  insertOne(object: InsertType): Promise<ResultType> {\n    if (!object._id) {\n      object._id = new ObjectID().toString();\n    }\n    if (!object.created) {\n      object.created = new Date();\n    }\n\n    return this.collection\n      .then(collection => collection.insertOne(object))\n      .then(({ result, connection, ops }) => {\n        if (!result.ok || result.n !== 1) {\n          throw new Error('Fail to insert');\n        }\n      })\n      .then(() => object);\n  }\n\n  updateOne(object) {\n    return this.replaceOne(object);\n  }\n\n  replaceOne(object: InsertType): Promise<ResultType> {\n    if (!object.updated) {\n      object.updated = new Date();\n    }\n\n    return this.collection\n      .then(collection => collection.updateOne({ _id: object._id }, object))\n      .then(() => object);\n  }\n\n  upsertOne(object: InsertType): Promise<ResultType> {\n    if (!object.updated) {\n      object.updated = new Date();\n    }\n\n    return this.collection\n      .then(collection =>\n        collection.updateOne({ _id: object._id }, { $set: object }, { upsert: true }),\n      )\n      .then(() => object);\n  }\n\n  replaceSeveral(objects: Array<InsertType>): Promise<Array<ResultType>> {\n    return Promise.all(objects.map(object => this.updateOne(object)));\n  }\n\n  _partialUpdate(partialUpdate: Object) {\n    // https://docs.mongodb.com/manual/reference/operator/update/\n    // if has a mongo operator\n    if (Object.keys(partialUpdate).some(key => key[0] === '$')) {\n      return partialUpdate;\n    } else {\n      return { $set: partialUpdate };\n    }\n  }\n\n  async partialUpdateByKey(key: any, partialUpdate: UpdateType): Promise<ResultType> {\n    partialUpdate = this._partialUpdate(partialUpdate);\n    const collection = await this.collection;\n    const commandResult: MongoUpdateCommandResultType = await collection.updateOne(\n      { _id: key },\n      partialUpdate,\n    );\n    if (!commandResult.result.ok) {\n      console.error(commandResult);\n      throw new Error('Update failed');\n    }\n    return this.findByKey(key);\n  }\n\n  partialUpdateOne(object: ResultType, partialUpdate: UpdateType): Promise<ResultType> {\n    partialUpdate = this._partialUpdate(partialUpdate);\n    return this.partialUpdateByKey(object._id, partialUpdate);\n  }\n\n  partialUpdateMany(criteria, partialUpdate: UpdateType): Promise<void> {\n    partialUpdate = this._partialUpdate(partialUpdate);\n    return this.collection\n      .then(collection => collection.updateMany(criteria, partialUpdate))\n      .then(res => undefined); // TODO return updated object\n  }\n\n  deleteByKey(key: any): Promise<void> {\n    return this.collection\n      .then(collection => collection.removeOne({ _id: key }))\n      .then(() => undefined);\n  }\n\n  cursor(criteria: ?Object, sort: ?Object): Promise<MongoCursor<ResultType>> {\n    return this.collection\n      .then(collection => collection.find(criteria))\n      .then(sort && (cursor => cursor.sort(sort)))\n      .then(cursor => new MongoCursor(this, cursor));\n  }\n\n  findByKey(key: any): Promise<?ResultType> {\n    return this.findOne({ _id: key });\n  }\n\n  findOne(criteria: Object, sort: ?Object): Promise<?ResultType> {\n    return this.collection\n      .then(collection => collection.find(criteria))\n      .then(sort && (cursor => cursor.sort(sort)))\n      .then(cursor => cursor.limit(1).next());\n  }\n}\n"],"names":["logger","Logger","MongoConnection","AbstractConnection","config","has","set","Error","connectionString","get","connect","info","connectPromise","MongoClient","then","connection","on","warn","connectionFailed","getConnection","Promise","reject","resolve","_connection","err","_connecting","catch","error","message","nextTick","exit","close","MongoCursor","AbstractCursor","store","cursor","_cursor","count","skip","next","value","_result","key","_id","newLimit","limit","applyLimit","undefined","_store","toArray","MongoStore","AbstractStore","collectionName","keyPath","_collection","db","collection","object","ObjectID","toString","created","Date","insertOne","result","ops","ok","n","replaceOne","updated","updateOne","$set","upsert","objects","all","map","partialUpdate","Object","keys","some","partialUpdateByKey","_partialUpdate","commandResult","findByKey","criteria","updateMany","removeOne","sort","find","findOne"],"mappings":"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"}