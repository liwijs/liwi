{"version":3,"file":"index-node8.cjs.js","sources":["../src/RestCursor.js","../src/RestService.js"],"sourcesContent":["export default class RestCursor {\n  constructor(restResource, connectedUser, cursor) {\n    this._restResource = restResource;\n    this._connectedUser = connectedUser;\n    this._cursor = cursor;\n  }\n\n  toArray() {\n    return this._cursor\n      .toArray()\n      .then(\n        results =>\n          results &&\n          results.map(result => this._restResource.transform(result, this._connectedUser)),\n      );\n  }\n}\n","import RestCursor from './RestCursor';\n\nexport default class RestService {\n  constructor(restResources: Map<string, any>) {\n    this.restResources = restResources;\n  }\n\n  addRestResource(key: string, restResource) {\n    this.restResources.set(key, restResource);\n  }\n\n  get(key: string) {\n    const restResource = this.restResources.get(key);\n    if (!restResource) throw new Error(`Invalid rest resource: \"${key}\"`);\n    return restResource;\n  }\n\n  async createCursor(\n    restResource,\n    connectedUser?: ?Object,\n    { criteria, sort, limit }: { criteria?: ?Object, sort?: ?Object, limit?: ?number },\n  ): Promise {\n    // TODO: restResource.query(connectedUser, criteria || {}, sort).cursor()\n    criteria = restResource.criteria(connectedUser, criteria || {});\n    sort = restResource.sort(connectedUser, sort);\n    const cursor = await restResource.store.cursor(criteria, sort);\n    limit = restResource.limit(limit);\n    if (limit) cursor.limit(connectedUser, limit);\n    return new RestCursor(restResource, connectedUser, cursor);\n  }\n}\n"],"names":["RestCursor","restResource","connectedUser","cursor","_restResource","_connectedUser","_cursor","toArray","then","results","map","result","transform","RestService","restResources","key","set","get","Error","createCursor","criteria","sort","limit","store"],"mappings":";;;;IAAqBA,aAAN,MAAiB;cAClBC,YAAZ,EAA0BC,aAA1B,EAAyCC,MAAzC,EAAiD;SAC1CC,aAAL,GAAqBH,YAArB;SACKI,cAAL,GAAsBH,aAAtB;SACKI,OAAL,GAAeH,MAAf;;;YAGQ;WACD,KAAKG,OAAL,CACJC,OADI,GAEJC,IAFI,CAGHC,WACEA,WACAA,QAAQC,GAAR,CAAYC,UAAU,KAAKP,aAAL,CAAmBQ,SAAnB,CAA6BD,MAA7B,EAAqC,KAAKN,cAA1C,CAAtB,CALC,CAAP;;;;ICNiBQ,cAAN,MAAkB;cACnBC,aAAZ,EAA6C;SACtCA,aAAL,GAAqBA,aAArB;;;kBAGcC,GAAhB,EAA6Bd,YAA7B,EAA2C;SACpCa,aAAL,CAAmBE,GAAnB,CAAuBD,GAAvB,EAA4Bd,YAA5B;;;MAGEc,GAAJ,EAAiB;UACTd,eAAe,KAAKa,aAAL,CAAmBG,GAAnB,CAAuBF,GAAvB,CAArB;QACI,CAACd,YAAL,EAAmB,MAAM,IAAIiB,KAAJ,CAAW,2BAA0BH,GAAI,GAAzC,CAAN;WACZd,YAAP;;;QAGIkB,YAAN,CACElB,YADF,EAEEC,aAFF,EAGE,EAAEkB,QAAF,EAAYC,IAAZ,EAAkBC,KAAlB,EAHF,EAIW;;eAEErB,aAAamB,QAAb,CAAsBlB,aAAtB,EAAqCkB,cAArC,CAAX;WACOnB,aAAaoB,IAAb,CAAkBnB,aAAlB,EAAiCmB,IAAjC,CAAP;UACMlB,SAAS,MAAMF,aAAasB,KAAb,CAAmBpB,MAAnB,CAA0BiB,QAA1B,EAAoCC,IAApC,CAArB;YACQpB,aAAaqB,KAAb,CAAmBA,KAAnB,CAAR;QACIA,KAAJ,EAAWnB,OAAOmB,KAAP,CAAapB,aAAb,EAA4BoB,KAA5B;WACJ,IAAItB,UAAJ,CAAeC,YAAf,EAA6BC,aAA7B,EAA4CC,MAA5C,CAAP;;;;;;"}