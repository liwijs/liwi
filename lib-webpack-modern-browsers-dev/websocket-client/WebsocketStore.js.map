{"version":3,"sources":["../../src/websocket-client/WebsocketStore.js"],"names":["AbstractStore","WebsocketCursor","encode","decode","Query","WebsocketConnection","emit","isConnected","WebsocketStore","constructor","websocket","restName","keyPath","Error","createQuery","key","type","connection","isDisconnected","args","buffer","then","result","insertOne","object","updateOne","updateSeveral","objects","partialUpdateByKey","partialUpdate","partialUpdateOne","partialUpdateMany","criteria","deleteByKey","deleteOne","cursor","sort","Promise","resolve","findByKey","findOne","_id"],"mappings":"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","file":"WebsocketStore.js","sourcesContent":["import AbstractStore from '../store/AbstractStore';\nimport WebsocketCursor from './WebsocketCursor';\nimport { encode, decode } from '../msgpack';\nimport Query from './Query';\n\ntype WebsocketConnection = {\n    emit: Function,\n    isConnected: Function,\n}\n\nexport default class WebsocketStore<ModelType> extends AbstractStore<WebsocketConnection> {\n  keyPath = '_id';\n\n  constructor(websocket: WebsocketConnection, restName: string) {\n    super(websocket);\n\n    if (!restName) {\n      throw new Error(`Invalid restName: \"${restName}\"`);\n    }\n\n    this.restName = restName;\n  }\n\n  createQuery(key: string) {\n    return new Query(this, key);\n  }\n\n  emit(type, ...args) {\n    if (this.connection.isDisconnected()) {\n      throw new Error('Websocket is not connected');\n    }\n\n    return this.connection.emit('rest', {\n      type,\n      restName: this.restName,\n      buffer: args && encode(args),\n    }).then(result => decode(result));\n  }\n\n  insertOne(object: ModelType): Promise<ModelType> {\n    return this.emit('insertOne', object);\n  }\n\n  updateOne(object: ModelType): Promise<ModelType> {\n    return this.emit('updateOne', object);\n  }\n\n  updateSeveral(objects: Array<ModelType>): Promise<Array<ModelType>> {\n    return this.emit('updateSeveral', objects);\n  }\n\n  partialUpdateByKey(key: any, partialUpdate: Object): Promise {\n    return this.emit('partialUpdateByKey', key, partialUpdate);\n  }\n\n  partialUpdateOne(object: ModelType, partialUpdate: Object): Promise<ModelType> {\n    return this.emit('partialUpdateOne', object, partialUpdate);\n  }\n\n  partialUpdateMany(criteria, partialUpdate: Object): Promise {\n    return this.emit('partialUpdateMany', criteria, partialUpdate);\n  }\n\n  deleteByKey(key: any): Promise {\n    return this.emit('deleteByKey', key);\n  }\n\n  deleteOne(object: ModelType): Promise {\n    return this.emit('deleteOne', object);\n  }\n\n  cursor(criteria: ?Object, sort: ?Object): Promise<WebsocketCursor<ModelType>> {\n    return Promise.resolve(new WebsocketCursor(this, { criteria, sort }));\n  }\n\n  findByKey(key: any) {\n    return this.findOne({ _id: key });\n  }\n\n  findOne(criteria: Object, sort: ?Object): Promise<Object> {\n    return this.emit('findOne', criteria, sort);\n  }\n}\n"]}