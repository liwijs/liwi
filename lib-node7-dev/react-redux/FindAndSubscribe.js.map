{"version":3,"sources":["../../src/react-redux/FindAndSubscribe.js"],"names":["FindAndSubscribeComponent","state","fetched","result","componentDidMount","query","props","_subscribe","fetchAndSubscribe","err","change","alert","newResult","setState","componentWillUnmount","stop","render","loadingComponent","createElement","component","name"],"mappings":";;;;;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,0DAAiB,6BACf,uCAAM,8BAAN,CADe,EAEf,wCAAO,wCAAP,CAFe,EAGf,4CAAW,6CAAX,CAHe,EAIf,mDAAkB,+BAAC,6CAAD,CAAlB,CAJe,CAAjB;;IAOqBA,yB,0CACd,S,iCADQ,+BAAkD;AAAA;AAAA;;AAAA,2FAG/DC,KAH+D,GAGvD;AACNC,eAAS,KADH;AAENC;AAFM,KAHuD;AAAA;;AAQ/DC,sBAAoB;AAClB,UAAM,EAAEC,KAAF,KAAY,KAAKC,KAAvB;AACA,SAAKC,UAAL,GAAkBF,MAAMG,iBAAN,CAAwB,CAACC,GAAD,EAAMC,MAAN,KAAiB;AACzD,UAAID,GAAJ,EAAS;AACP;AACAE,cAAO,qBAAoBF,GAAI,EAA/B;AACA;AACD;;AAED,YAAMG,YAAY,2BAAY,KAAKX,KAAL,CAAWE,MAAvB,EAA+BO,MAA/B,CAAlB;;AAEA,UAAI,CAAC,KAAKT,KAAL,CAAWC,OAAhB,EAAyB;AACvB,aAAKW,QAAL,CAAc,EAAEX,SAAS,IAAX,EAAiBC,QAAQS,SAAzB,EAAd;AACD,OAFD,MAEO,IAAIA,cAAc,KAAKX,KAAL,CAAWE,MAA7B,EAAqC;AAC1C,aAAKU,QAAL,CAAc,EAAEV,QAAQS,SAAV,EAAd;AACD;AACF,KAdiB,CAAlB;AAeD;;AAEDE,yBAAuB;AACrB,QAAI,KAAKP,UAAT,EAAqB;AACnB,WAAKA,UAAL,CAAgBQ,IAAhB;AACA,aAAO,KAAKR,UAAZ;AACD;AACF;;AAEDS,WAAwB;AAAA,qDAAd,wCAAc;;AACtB,QAAI,CAAC,KAAKf,KAAL,CAAWC,OAAhB,EAAyB;AACvB,gCAAO,KAAKI,KAAL,CAAWW,gBAAX,GAA8B,gBAAMC,aAAN,CAAoB,KAAKZ,KAAL,CAAWW,gBAA/B,CAA9B,GAAiF,IAAxF;AACD;;AAED,8BAAO,gBAAMC,aAAN,CAAoB,KAAKZ,KAAL,CAAWa,SAA/B,EAA0C,EAAE,CAAC,KAAKb,KAAL,CAAWc,IAAZ,GAAmB,KAAKnB,KAAL,CAAWE,MAAhC,EAA1C,CAAP;AACD;AAxC8D,C,sDAC1D,S;;;;kBADcH,yB","file":"FindAndSubscribe.js","sourcesContent":["import React, { Component } from 'react';\nimport type { ReactNodeType, ReactComponentType } from 'alp-react-redux/types';\nimport type AbstractQuery from '../store/AbstractQuery';\nimport applyChange from './applyChange';\n\ntype PropsType = {\n  name: string,\n  query: AbstractQuery,\n  component: ReactComponentType,\n  loadingComponent: ?ReactComponentType,\n};\n\nexport default class FindAndSubscribeComponent extends Component {\n  props: PropsType;\n\n  state = {\n    fetched: false,\n    result: [],\n  };\n\n  componentDidMount() {\n    const { query } = this.props;\n    this._subscribe = query.fetchAndSubscribe((err, change) => {\n      if (err) {\n        // eslint-disable-next-line no-alert\n        alert(`Unexpected error: ${err}`);\n        return;\n      }\n\n      const newResult = applyChange(this.state.result, change);\n\n      if (!this.state.fetched) {\n        this.setState({ fetched: true, result: newResult });\n      } else if (newResult !== this.state.result) {\n        this.setState({ result: newResult });\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    if (this._subscribe) {\n      this._subscribe.stop();\n      delete this._subscribe;\n    }\n  }\n\n  render(): ReactNodeType {\n    if (!this.state.fetched) {\n      return this.props.loadingComponent ? React.createElement(this.props.loadingComponent) : null;\n    }\n\n    return React.createElement(this.props.component, { [this.props.name]: this.state.result });\n  }\n}\n"]}