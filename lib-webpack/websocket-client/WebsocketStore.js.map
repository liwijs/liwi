{"version":3,"sources":["../../src/websocket-client/WebsocketStore.js"],"names":["AbstractStore","WebsocketCursor","encode","decode","Query","WebsocketStore","websocket","restName","keyPath","Error","key","type","connection","isDisconnected","args","emit","buffer","then","result","object","objects","partialUpdate","criteria","sort","Promise","resolve","findOne","_id"],"mappings":";;;;;;;;AAAA,OAAOA,aAAP,MAA0B,wBAA1B;AACA,OAAOC,eAAP,MAA4B,mBAA5B;AACA,SAASC,MAAT,EAAiBC,MAAjB,QAA+B,YAA/B;AACA,OAAOC,KAAP,MAAkB,SAAlB;;IAOqBC,c;;;AAGnB,0BAAYC,SAAZ,EAA4CC,QAA5C,EAA8D;AAAA;;AAAA,gIACtDD,SADsD;;AAAA,UAF9DE,OAE8D,GAFpD,KAEoD;;;AAG5D,QAAI,CAACD,QAAL,EAAe;AACb,YAAM,IAAIE,KAAJ,yBAAgCF,QAAhC,OAAN;AACD;;AAED,UAAKA,QAAL,GAAgBA,QAAhB;AAP4D;AAQ7D;;;;gCAEWG,G,EAAa;AACvB,aAAO,IAAIN,KAAJ,CAAU,IAAV,EAAgBM,GAAhB,CAAP;AACD;;;yBAEIC,I,EAAe;AAClB,UAAI,KAAKC,UAAL,CAAgBC,cAAhB,EAAJ,EAAsC;AACpC,cAAM,IAAIJ,KAAJ,CAAU,4BAAV,CAAN;AACD;;AAHiB,wCAANK,IAAM;AAANA,YAAM;AAAA;;AAKlB,aAAO,KAAKF,UAAL,CAAgBG,IAAhB,CAAqB,MAArB,EAA6B;AAClCJ,kBADkC;AAElCJ,kBAAU,KAAKA,QAFmB;AAGlCS,gBAAQF,QAAQZ,OAAOY,IAAP;AAHkB,OAA7B,EAIJG,IAJI,CAIC;AAAA,eAAUd,OAAOe,MAAP,CAAV;AAAA,OAJD,CAAP;AAKD;;;8BAESC,M,EAAuC;AAC/C,aAAO,KAAKJ,IAAL,CAAU,WAAV,EAAuBI,MAAvB,CAAP;AACD;;;8BAESA,M,EAAuC;AAC/C,aAAO,KAAKJ,IAAL,CAAU,WAAV,EAAuBI,MAAvB,CAAP;AACD;;;kCAEaC,O,EAAsD;AAClE,aAAO,KAAKL,IAAL,CAAU,eAAV,EAA2BK,OAA3B,CAAP;AACD;;;uCAEkBV,G,EAAUW,a,EAAgC;AAC3D,aAAO,KAAKN,IAAL,CAAU,oBAAV,EAAgCL,GAAhC,EAAqCW,aAArC,CAAP;AACD;;;qCAEgBF,M,EAAmBE,a,EAA2C;AAC7E,aAAO,KAAKN,IAAL,CAAU,kBAAV,EAA8BI,MAA9B,EAAsCE,aAAtC,CAAP;AACD;;;sCAEiBC,Q,EAAUD,a,EAAgC;AAC1D,aAAO,KAAKN,IAAL,CAAU,mBAAV,EAA+BO,QAA/B,EAAyCD,aAAzC,CAAP;AACD;;;gCAEWX,G,EAAmB;AAC7B,aAAO,KAAKK,IAAL,CAAU,aAAV,EAAyBL,GAAzB,CAAP;AACD;;;8BAESS,M,EAA4B;AACpC,aAAO,KAAKJ,IAAL,CAAU,WAAV,EAAuBI,MAAvB,CAAP;AACD;;;2BAEMG,Q,EAAmBC,I,EAAoD;AAC5E,aAAOC,QAAQC,OAAR,CAAgB,IAAIxB,eAAJ,CAAoB,IAApB,EAA0B,EAAEqB,kBAAF,EAAYC,UAAZ,EAA1B,CAAhB,CAAP;AACD;;;8BAESb,G,EAAU;AAClB,aAAO,KAAKgB,OAAL,CAAa,EAAEC,KAAKjB,GAAP,EAAb,CAAP;AACD;;;4BAEOY,Q,EAAkBC,I,EAAgC;AACxD,aAAO,KAAKR,IAAL,CAAU,SAAV,EAAqBO,QAArB,EAA+BC,IAA/B,CAAP;AACD;;;;EAvEoDvB,a;;eAAlCK,c","file":"WebsocketStore.js","sourcesContent":["import AbstractStore from '../store/AbstractStore';\nimport WebsocketCursor from './WebsocketCursor';\nimport { encode, decode } from '../msgpack';\nimport Query from './Query';\n\ntype WebsocketConnection = {\n    emit: Function,\n    isConnected: Function,\n}\n\nexport default class WebsocketStore<ModelType> extends AbstractStore<WebsocketConnection> {\n  keyPath = '_id';\n\n  constructor(websocket: WebsocketConnection, restName: string) {\n    super(websocket);\n\n    if (!restName) {\n      throw new Error(`Invalid restName: \"${restName}\"`);\n    }\n\n    this.restName = restName;\n  }\n\n  createQuery(key: string) {\n    return new Query(this, key);\n  }\n\n  emit(type, ...args) {\n    if (this.connection.isDisconnected()) {\n      throw new Error('Websocket is not connected');\n    }\n\n    return this.connection.emit('rest', {\n      type,\n      restName: this.restName,\n      buffer: args && encode(args),\n    }).then(result => decode(result));\n  }\n\n  insertOne(object: ModelType): Promise<ModelType> {\n    return this.emit('insertOne', object);\n  }\n\n  updateOne(object: ModelType): Promise<ModelType> {\n    return this.emit('updateOne', object);\n  }\n\n  updateSeveral(objects: Array<ModelType>): Promise<Array<ModelType>> {\n    return this.emit('updateSeveral', objects);\n  }\n\n  partialUpdateByKey(key: any, partialUpdate: Object): Promise {\n    return this.emit('partialUpdateByKey', key, partialUpdate);\n  }\n\n  partialUpdateOne(object: ModelType, partialUpdate: Object): Promise<ModelType> {\n    return this.emit('partialUpdateOne', object, partialUpdate);\n  }\n\n  partialUpdateMany(criteria, partialUpdate: Object): Promise {\n    return this.emit('partialUpdateMany', criteria, partialUpdate);\n  }\n\n  deleteByKey(key: any): Promise {\n    return this.emit('deleteByKey', key);\n  }\n\n  deleteOne(object: ModelType): Promise {\n    return this.emit('deleteOne', object);\n  }\n\n  cursor(criteria: ?Object, sort: ?Object): Promise<WebsocketCursor<ModelType>> {\n    return Promise.resolve(new WebsocketCursor(this, { criteria, sort }));\n  }\n\n  findByKey(key: any) {\n    return this.findOne({ _id: key });\n  }\n\n  findOne(criteria: Object, sort: ?Object): Promise<Object> {\n    return this.emit('findOne', criteria, sort);\n  }\n}\n"]}