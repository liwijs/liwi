{"version":3,"sources":["../../src/rest-websocket/index.js"],"names":[],"mappings":";;;;AAAA,OAAO,MAAP,MAAmB,oBAAnB;;AAEA,IAAM,SAAS,IAAI,MAAJ,CAAW,qBAAX,CAAf;;AAEA,eAAe,SAAS,IAAT,CAAc,EAAd,EAAkB,WAAlB,EAA+B;AAC1C,OAAG,EAAH,CAAM,YAAN,EAAoB,kBAAU;AAC1B,eAAO,EAAP,CAAU,MAAV,EAAkB,gBAAyD,IAAzD,EAAsE,QAAtE,EAA6F;AAAA,gBAA1F,IAA0F,QAA1F,IAA0F;AAAA,gBAApF,QAAoF,QAApF,QAAoF;;AAC3G,mBAAO,IAAP,CAAY,MAAZ,EAAoB,EAAE,UAAF,EAAQ,kBAAR,EAAkB,UAAlB,EAApB;AACA,oBAAQ,IAAR;AACI,qBAAK,gBAAL;AAAuB;AAAA,mDACD,IADC;;AAAA,4BACZ,OADY;;AAEnB,+BAAO,YAAY,YAAZ,CAAyB,QAAzB,EAAmC,OAAnC,EACF,IADE,CACG;AAAA,mCAAU,OAAO,OAAP,EAAV;AAAA,yBADH,EAEF,IAFE,CAEG;AAAA,mCAAW,SAAS,IAAT,EAAe,OAAf,CAAX;AAAA,yBAFH,EAGF,KAHE,CAGI;AAAA,mCAAO,SAAS,IAAI,OAAb,CAAP;AAAA,yBAHJ,CAAP;AAIH;;AAED,qBAAK,WAAL;AACA,qBAAK,WAAL;AACA,qBAAK,eAAL;AACA,qBAAK,oBAAL;AACA,qBAAK,kBAAL;AACA,qBAAK,mBAAL;AACA,qBAAK,aAAL;AACA,qBAAK,WAAL;AACA,qBAAK,SAAL;AACI,2BAAO,YAAY,GAAZ,CAAgB,IAAhB,oBAAsB,QAAtB,4BAAmC,IAAnC,IACF,IADE,CACG;AAAA,+BAAU,SAAS,IAAT,EAAe,MAAf,CAAV;AAAA,qBADH,EAEF,KAFE,CAEI;AAAA,+BAAO,SAAS,IAAI,OAAJ,IAAe,GAAxB,CAAP;AAAA,qBAFJ,CAAP;;AAIJ;AACI,oDAA8B,IAA9B;AAvBR;AAyBH,SA3BD;AA4BH,KA7BD;AA8BH","file":"index.js","sourcesContent":["import Logger from 'nightingale-logger';\n\nconst logger = new Logger('liwi.rest-websocket');\n\nexport default function init(io, restService) {\n    io.on('connection', socket => {\n        socket.on('rest', ({ type, restName }: { type: string; restName: string }, args: Array, callback: Function) => {\n            logger.info('rest', { type, restName, args });\n            switch (type) {\n                case 'cursor toArray': {\n                    const [options] = args;\n                    return restService.createCursor(restName, options)\n                        .then(cursor => cursor.toArray())\n                        .then(results => callback(null, results))\n                        .catch(err => callback(err.message));\n                }\n\n                case 'insertOne':\n                case 'updateOne':\n                case 'updateSeveral':\n                case 'partialUpdateByKey':\n                case 'partialUpdateOne':\n                case 'partialUpdateMany':\n                case 'deleteByKey':\n                case 'deleteOne':\n                case 'findOne':\n                    return restService.get(type)(restName, ...args)\n                        .then(result => callback(null, result))\n                        .catch(err => callback(err.message || err));\n\n                default:\n                    callback(`Unknown command: \"${type}\"`);\n            }\n        });\n    });\n}\n"]}