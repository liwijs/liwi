{"version":3,"sources":["../../src/websocket-client/WebsocketCursor.js"],"names":[],"mappings":"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","file":"WebsocketCursor.js","sourcesContent":["import WebsocketStore from './WebsocketStore';\nimport AbstractCursor from '../store/AbstractCursor';\n\nexport default class WebsocketCursor<ModelType> extends AbstractCursor<WebsocketStore<ModelType>> {\n    _idCursor: ?number;\n    _options: ?Object;\n    _result: ?Object;\n\n    constructor(store:WebsocketStore, options) {\n        super(store);\n        this._options = options;\n    }\n\n    /* options */\n\n    limit(newLimit:number):Promise<this> {\n        if (this._idCursor) throw new Error('Cursor already created');\n        this._options.limit = newLimit;\n        return Promise.resolve(this);\n    }\n\n    /* results */\n\n    _create() {\n        if (this._idCursor) throw new Error('Cursor already created');\n        return this.store.connection.emit('createCursor', this._options).then(idCursor => {\n            if (!idCursor) return;\n            this._idCursor = idCursor;\n        });\n    }\n\n    emit(type, ...args):Promise {\n        if (!this._idCursor) {\n            return this._create().then(() => this.emit(type, ...args));\n        }\n\n        return this.store.emit('cursor', { type, id: this._idCursor }, args);\n    }\n\n    advance(count:number) {\n        this.emit('advance', count);\n        return this;\n    }\n\n    next():Promise<?any> {\n        return this.emit('next').then(result => {\n            this._result = result;\n            this.key = result && result[this._store.keyPath];\n            return this.key;\n        });\n    }\n\n    result():Promise<?ModelType> {\n        return Promise.resolve(this._result);\n    }\n\n    count(applyLimit:boolean = false) {\n        return this.emit('count', applyLimit);\n    }\n\n    close():Promise {\n        if (!this._store) return Promise.resolve();\n\n        const closedPromise = this._idCursor ? this.emit('close') : Promise.resolve();\n        this._idCursor = this._options = null;\n        this._store = this._result = undefined;\n        return closedPromise;\n    }\n\n    toArray():Promise<Array> {\n        return this.store.emit('cursor toArray', this._options, result => {\n            this.close();\n            return result;\n        });\n    }\n}\n"]}