{"version":3,"sources":["../../src/websocket-client/WebsocketCursor.js"],"names":[],"mappings":";;;;;;;;;;AAAA,OAAO,cAAP,MAA2B,kBAA3B;AACA,OAAO,cAAP,MAA2B,yBAA3B;;IAEqB,e;;;AAKnB,2BAAY,KAAZ,EAAkC,OAAlC,EAA2C;AAAA;;AAAA,UAA/B,KAA+B,YAAzB,cAAyB;AAAA,2HAA/B,KAA+B;AAAA;;AAAA,mGACnC,KADmC;;AAEzC,UAAK,QAAL,GAAgB,OAAhB;;AAFyC,UAEzC,MAAK,QAFoC,YAEzC,MAAK,QAFoC,YAHhC,MAGgC;AAAA,mHAEzC,MAAK,QAFoC;AAAA;;AAAA;AAG1C;;AAEC;;;;0BAEI,Q,EAA+B;AAAA;AAAA,6BAAd,OAAc;AAAA;AAAA;;AAAA;AAAA;;AAAA,mBAA/B,QAA+B;AAAA,wHAA/B,QAA+B;AAAA;;AACnC,UAAI,KAAK,SAAT,EAAoB,MAAM,IAAI,KAAJ,CAAU,wBAAV,CAAN;AACpB,WAAK,QAAL,CAAc,KAAd,GAAsB,QAAtB;AAFmC,kBAG5B,QAAQ,OAAR,CAAgB,IAAhB,CAH4B;AAIpC;;AAEC;;;;8BAEQ;AAAA;;AACR,UAAI,KAAK,SAAT,EAAoB,MAAM,IAAI,KAAJ,CAAU,wBAAV,CAAN;AACpB,aAAO,KAAK,KAAL,CAAW,UAAX,CAAsB,IAAtB,CAA2B,cAA3B,EAA2C,KAAK,QAAhD,EAA0D,IAA1D,CAA+D,oBAAY;AAChF,YAAI,CAAC,QAAL,EAAe;AACf,eAAK,SAAL,GAAiB,QAAjB;;AAFgF,cAEhF,OAAK,SAF2E,mBAEhF,OAAK,SAF2E;AAAA,wHAEhF,OAAK,SAF2E;AAAA;AAGjF,OAHM,CAAP;AAID;;;yBAEI,I,EAAuB;AAAA;;AAAA,wCAAd,IAAc;AAAd,YAAc;AAAA;;AAAA;AAAA,8BAAR,OAAQ;AAAA;AAAA;;AAAA;AAAA;;AAC1B,UAAI,CAAC,KAAK,SAAV,EAAqB;AAAA,qBACZ,KAAK,OAAL,GAAe,IAAf,CAAoB;AAAA,iBAAM,OAAK,IAAL,gBAAU,IAAV,SAAmB,IAAnB,EAAN;AAAA,SAApB,CADY;AAEpB;;AAHyB,mBAKnB,KAAK,KAAL,CAAW,IAAX,CAAgB,QAAhB,EAA0B,EAAE,UAAF,EAAQ,IAAI,KAAK,SAAjB,EAA1B,EAAwD,IAAxD,CALmB;AAM3B;;;4BAEO,K,EAAc;AAAA,mBAAd,KAAc;AAAA,qHAAd,KAAc;AAAA;;AACpB,WAAK,IAAL,CAAU,SAAV,EAAqB,KAArB;AACA,aAAO,IAAP;AACD;;;2BAEoB;AAAA;;AAAA;AAAA,8BAAd,OAAc;AAAA;AAAA;;AAAA;AAAA;;AAAA,mBACZ,KAAK,IAAL,CAAU,MAAV,EAAkB,IAAlB,CAAuB,kBAAU;AACtC,eAAK,OAAL,GAAe,MAAf;;AADsC,cACtC,OAAK,OADiC,YACtC,OAAK,OADiC,YAvChC,MAuCgC;AAAA,sHACtC,OAAK,OADiC;AAAA;;AAEtC,eAAK,GAAL,GAAW,UAAU,OAAO,OAAK,MAAL,CAAY,OAAnB,CAArB;AACA,eAAO,OAAK,GAAZ;AACD,OAJM,CADY;AAMpB;;;6BAE4B;AAAA;AAAA,8BAApB,OAAoB;AAAA;AAAA;;AAAA;AAAA;;AAAA,mBACpB,QAAQ,OAAR,CAAgB,KAAK,OAArB,CADoB;AAE5B;;;4BAEiC;AAAA,UAA5B,UAA4B,yDAAP,KAAO;;AAAA,mBAA5B,UAA4B;AAAA,wHAA5B,UAA4B;AAAA;;AAChC,aAAO,KAAK,IAAL,CAAU,OAAV,EAAmB,UAAnB,CAAP;AACD;;;4BAEe;AAAA;AAAA,8BAAR,OAAQ;AAAA;AAAA;;AAAA;AAAA;;AACd,UAAI,CAAC,KAAK,MAAV,eAAyB,QAAQ,OAAR,EAAzB;;AAEA,UAAM,gBAAgB,KAAK,SAAL,GAAiB,KAAK,IAAL,CAAU,OAAV,CAAjB,GAAsC,QAAQ,OAAR,EAA5D;AACA,WAAK,SAAL,GAAiB,KAAK,QAAL,GAAgB,IAAjC;;AAJc,YAIG,KAAK,QAJR,YAIG,KAAK,QAJR,YAvDL,MAuDK;AAAA,qHAIG,KAAK,QAJR;AAAA;;AAAA,YAId,KAAK,SAJS,mBAId,KAAK,SAJS;AAAA,sHAId,KAAK,SAJS;AAAA;;AAKd,WAAK,MAAL,GAAc,KAAK,OAAL,GAAe,SAA7B;;AALc,YAKA,KAAK,OALL,YAKA,KAAK,OALL,YAtDN,MAsDM;AAAA,oHAKA,KAAK,OALL;AAAA;;AAAA,mBAMP,aANO;AAOf;;;8BAEwB;AAAA;;AAAA;AAAA,8BAAf,OAAe;AAAA;AAAA;;AAAA;AAAA;;AAAA,mBAChB,KAAK,KAAL,CAAW,IAAX,CAAgB,gBAAhB,EAAkC,KAAK,QAAvC,EAAiD,kBAAU;AAChE,eAAK,KAAL;AACA,eAAO,MAAP;AACD,OAHM,CADgB;AAKxB;;;;EAvEqD,c;;eAAnC,e","file":"WebsocketCursor.js","sourcesContent":["import WebsocketStore from './WebsocketStore';\nimport AbstractCursor from '../store/AbstractCursor';\n\nexport default class WebsocketCursor<ModelType> extends AbstractCursor<WebsocketStore<ModelType>> {\n  _idCursor: ?number;\n  _options: ?Object;\n  _result: ?Object;\n\n  constructor(store:WebsocketStore, options) {\n    super(store);\n    this._options = options;\n  }\n\n    /* options */\n\n  limit(newLimit:number):Promise<this> {\n    if (this._idCursor) throw new Error('Cursor already created');\n    this._options.limit = newLimit;\n    return Promise.resolve(this);\n  }\n\n    /* results */\n\n  _create() {\n    if (this._idCursor) throw new Error('Cursor already created');\n    return this.store.connection.emit('createCursor', this._options).then(idCursor => {\n      if (!idCursor) return;\n      this._idCursor = idCursor;\n    });\n  }\n\n  emit(type, ...args):Promise {\n    if (!this._idCursor) {\n      return this._create().then(() => this.emit(type, ...args));\n    }\n\n    return this.store.emit('cursor', { type, id: this._idCursor }, args);\n  }\n\n  advance(count:number) {\n    this.emit('advance', count);\n    return this;\n  }\n\n  next():Promise<?any> {\n    return this.emit('next').then(result => {\n      this._result = result;\n      this.key = result && result[this._store.keyPath];\n      return this.key;\n    });\n  }\n\n  result():Promise<?ModelType> {\n    return Promise.resolve(this._result);\n  }\n\n  count(applyLimit:boolean = false) {\n    return this.emit('count', applyLimit);\n  }\n\n  close():Promise {\n    if (!this._store) return Promise.resolve();\n\n    const closedPromise = this._idCursor ? this.emit('close') : Promise.resolve();\n    this._idCursor = this._options = null;\n    this._store = this._result = undefined;\n    return closedPromise;\n  }\n\n  toArray():Promise<Array> {\n    return this.store.emit('cursor toArray', this._options, result => {\n      this.close();\n      return result;\n    });\n  }\n}\n"]}