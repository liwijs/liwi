{"version":3,"sources":["../../src/store/AbstractCursor.js"],"names":["ResultType","AbstractCursor","constructor","store","_store","close","Error","next","nextResult","then","result","limit","newLimit","count","applyLimit","findByKey","key","delete","deleteByKey","forEachKeys","callback","forEach","keysIterator","Symbol","iterator","keyPromise"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA,SAAcA,yBAAd,QAAgC,UAAhC;;;;;;;IAEqBC,c,sBAChB,O,gCADU,MAA4B;;AAGzCC,cAAYC,KAAZ,EAA0B;AAAA;;AAAA;AAAA,aAHQ;AAGR;;AAAA,qBAAT,2DAAS;;AAAA;;AACxB,SAAKC,MAAL,GAAcD,KAAd;AACD;;AAED,MAAIA,KAAJ,GAAmB;AAAA,kCAAN,+CAAM;;AACjB,+BAAO,KAAKC,MAAZ;AACD;;AAEDC,UAAQ;AACN,UAAM,IAAIC,KAAJ,CAAU,gCAAV,CAAN;AACD;;AAEDC,SAAqB;AAAA,aAAL,OAAK;;AACnB,UAAM,IAAID,KAAJ,CAAU,+BAAV,CAAN;AACD;;AAEDE,eAA2B;AAAA,kCAAL,OAAK;;AACzB,WAAO,KAAKD,IAAL,GAAYE,IAAZ,CAAiB,MAAM,KAAKC,MAAL,EAAvB,CAAP;AACD;;AAEDC,QAAMC,QAAN,EAAuC;AAAA,wBAAzB,UAAyB;;AAAA,aAAN,QAAM;AAAA;;AACrC,UAAM,IAAIN,KAAJ,CAAU,gCAAV,CAAN;AACD;;AAEDO,QAAMC,aAAsB,KAA5B,EAAmC;AAAA,0BAAnB,WAAmB;;AAAA;;AACjC,UAAM,IAAIR,KAAJ,CAAU,gCAAV,CAAN;AACD;;AAEDI,WAA8B;AAAA,kCAAZ,iBAAY;;AAC5B,WAAO,KAAKP,KAAL,CAAWY,SAAX,CAAqB,KAAKC,GAA1B,CAAP;AACD;;AAEDC,WAAwB;AAAA,kCAAN,QAAM;;AACtB,WAAO,KAAKd,KAAL,CAAWe,WAAX,CAAuB,KAAKF,GAA5B,CAAP;AACD;;AAED,QAAMG,WAAN,CAAkBC,QAAlB,EAAqD;AAAA,wBAA3B,YAA2B;;AAAA,yCAAN,QAAM,EAAd,iBAAQ,QAAR,CAAc;;AAAA;;AACnD,WAAO,IAAP,EAAa;AACX,YAAMJ,MAAM,MAAM,KAAKT,IAAL,EAAlB;AACA,UAAI,CAACS,GAAL,EAAU;;AAEV,YAAMI,SAASJ,GAAT,CAAN;AACD;AACF;;AAEDK,UAAQD,QAAR,EAAiC;AAAA,kCAAN,QAAM;;AAC/B,WAAO,KAAKD,WAAL,CAAiB,MAAM,KAAKT,MAAL,GAAcD,IAAd,CAAmBC,UAAUU,SAASV,MAAT,CAA7B,CAAvB,CAAP;AACD;;AAED,GAAEY,YAAF,GAAiB;AACf,WAAO,IAAP,EAAa;AACX,YAAM,KAAKf,IAAL,EAAN;AACD;AACF;;AAED,IAAGgB,OAAOC,QAAV,IAAsB;AACpB;AACA,SAAK,IAAIC,UAAT,IAAuB,KAAKH,YAAL,EAAvB,EAA4C;AAC1C,YAAMG,WAAWhB,IAAX,CAAgBO,OAAOA,OAAO,KAAKN,MAAL,EAA9B,CAAN;AACD;AACF;;AAEC;AACA;;;;;;;;;;;;;;AAlEuC,C;;;;SAAtBT,c","file":"AbstractCursor.js","sourcesContent":["/* eslint-disable no-await-in-loop */\nimport type { ResultType } from '../types';\n\nexport default class AbstractCursor<Store> {\n  key: any;\n\n  constructor(store: Store) {\n    this._store = store;\n  }\n\n  get store(): Store {\n    return this._store;\n  }\n\n  close() {\n    throw new Error('close() missing implementation');\n  }\n\n  next(): Promise<any> {\n    throw new Error('next() missing implementation');\n  }\n\n  nextResult(): Promise<any> {\n    return this.next().then(() => this.result());\n  }\n\n  limit(newLimit: number): Promise<void> {\n    throw new Error('limit() missing implementation');\n  }\n\n  count(applyLimit: boolean = false) {\n    throw new Error('count() missing implementation');\n  }\n\n  result(): Promise<ResultType> {\n    return this.store.findByKey(this.key);\n  }\n\n  delete(): Promise<void> {\n    return this.store.deleteByKey(this.key);\n  }\n\n  async forEachKeys(callback: Function): Promise<void> {\n    while (true) {\n      const key = await this.next();\n      if (!key) return;\n\n      await callback(key);\n    }\n  }\n\n  forEach(callback): Promise<void> {\n    return this.forEachKeys(() => this.result().then(result => callback(result)));\n  }\n\n  * keysIterator() {\n    while (true) {\n      yield this.next();\n    }\n  }\n\n  * [Symbol.iterator]() {\n    // eslint-disable-next-line no-restricted-syntax\n    for (let keyPromise of this.keysIterator()) {\n      yield keyPromise.then(key => key && this.result());\n    }\n  }\n\n    // TODO Symbol.asyncIterator, https://phabricator.babeljs.io/T7356\n    /*\n    async *keysAsyncIterator() {\n        while (true) {\n             const key = await this.next();\n             if (!key) return;\n\n             yield key;\n        }\n     }\n\n     async *[Symbol.asyncIterator] {\n        for await (let key of this.keysAsyncIterator()) {\n            yield await this.result();\n        }\n     }\n     */\n}\n"]}